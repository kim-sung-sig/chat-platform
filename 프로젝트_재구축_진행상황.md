# ì±„íŒ… í”Œë«í¼ ì¬êµ¬ì¶• ì§„í–‰ ìƒí™©

**ì‘ì„±ì¼**: 2025-12-06  
**í”„ë¡œì íŠ¸**: chat-platform  
**ë‹´ë‹¹ì**: Backend Engineer (DDD ì „ë¬¸)

---

## âœ… Phase 1 ì™„ë£Œ: Common ëª¨ë“ˆ ì„¸ë¶„í™”

### 1.1 settings.gradle ì—…ë°ì´íŠ¸
- âœ… `domain` ëª¨ë“ˆ ì œê±°
- âœ… `chat-common` ì œê±°
- âœ… `common-util`, `common-auth`, `common-logging` ì¶”ê°€

### 1.2 common-util ëª¨ë“ˆ ìƒì„± ë° ë¹Œë“œ ì„±ê³µ âœ…
**ìœ„ì¹˜**: `C:\git\chat-platform\common-util`

#### ìƒì„±ëœ í´ë˜ìŠ¤
**ì˜ˆì™¸ ì²˜ë¦¬ (exception)**
- `ErrorCode.java` - ì—ëŸ¬ ì½”ë“œ ì¸í„°í˜ì´ìŠ¤
- `BaseErrorCode.java` - ê¸°ë³¸ ì—ëŸ¬ ì½”ë“œ enum
- `BaseException.java` - ê¸°ë³¸ ì˜ˆì™¸ í´ë˜ìŠ¤
- `ErrorResponse.java` - ì—ëŸ¬ ì‘ë‹µ DTO
- `GlobalExceptionHandler.java` - ê¸€ë¡œë²Œ ì˜ˆì™¸ í•¸ë“¤ëŸ¬ (@RestControllerAdvice)

**ìƒìˆ˜ (constants)**
- `HeaderConstants.java` - HTTP í—¤ë” ìƒìˆ˜ (Authorization, X-User-Id, X-Trace-Id ë“±)
- `SystemConstants.java` - ì‹œìŠ¤í…œ ìƒìˆ˜ (í˜ì´ì§•, ìºì‹œ TTL, ì¬ì‹œë„ ì„¤ì • ë“±)

**ìœ í‹¸ë¦¬í‹° (util)**
- `Cursor.java` - Cursor ê¸°ë°˜ í˜ì´ì§• VO
- `CursorCodec.java` - Cursor ì¸ì½”ë”©/ë””ì½”ë”© (Base64)
- `DateTimeUtil.java` - ë‚ ì§œ/ì‹œê°„ ìœ í‹¸ë¦¬í‹°
- `IdGenerator.java` - ID ìƒì„± ìœ í‹¸ë¦¬í‹° (UUID, Timestamp, Snowflake ê¸°ë°˜)

#### Dependencies
```groovy
- Spring Web, Spring Context (6.2.1)
- Jackson Databind (2.18.2)
- Jakarta Validation API (3.1.0)
- Jakarta Servlet API (6.1.0) - compileOnly
- SLF4J API (2.0.16)
- Lombok (1.18.36)
```

### 1.3 common-auth ëª¨ë“ˆ ìƒì„± ë° ë¹Œë“œ ì„±ê³µ âœ…
**ìœ„ì¹˜**: `C:\git\chat-platform\common-auth`

#### ìƒì„±ëœ í´ë˜ìŠ¤
**ëª¨ë¸ (model)**
- `UserId.java` - ì‚¬ìš©ì ID Value Object (ë¶ˆë³€)
- `AuthUser.java` - ì¸ì¦ëœ ì‚¬ìš©ì ì •ë³´ (Principal)

**ì»¨í…ìŠ¤íŠ¸ (context)**
- `UserContextHolder.java` - ThreadLocal ê¸°ë°˜ ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸ í™€ë”

#### Dependencies
```groovy
- common-util (api)
- Spring Boot Security (3.5.6)
- JWT (jjwt-api: 0.12.3)
- Jakarta Servlet API (6.1.0)
```

#### í–¥í›„ êµ¬í˜„ í•„ìš”
- [ ] `JwtTokenProvider` - JWT ìƒì„±/ê²€ì¦
- [ ] `JwtProperties` - JWT ì„¤ì •
- [ ] `UserPrincipal` - Spring Security Principal êµ¬í˜„
- [ ] `JwtAuthenticationFilter` - JWT í•„í„°
- [ ] `@RequireAuth`, `@RequireRole` ì–´ë…¸í…Œì´ì…˜
- [ ] `AuthAspect` - ê¶Œí•œ ì²´í¬ AOP

### 1.4 common-logging ëª¨ë“ˆ ìƒì„± ë° ë¹Œë“œ ì„±ê³µ âœ…
**ìœ„ì¹˜**: `C:\git\chat-platform\common-logging`

#### ìƒì„±ëœ í´ë˜ìŠ¤
- `MdcUtil.java` - MDC ìœ í‹¸ë¦¬í‹° (TraceId, SpanId, UserId, RequestId ê´€ë¦¬)

#### Dependencies
```groovy
- common-util (api)
- SLF4J API (2.0.16)
- Logback Classic (1.5.16)
- Spring Web (6.2.1)
- Jakarta Servlet API (6.1.0) - compileOnly
```

#### í–¥í›„ êµ¬í˜„ í•„ìš”
- [ ] `TraceIdGenerator` - Trace/Span ID ìƒì„±
- [ ] `TraceContext` - ì¶”ì  ì»¨í…ìŠ¤íŠ¸
- [ ] `RequestLoggingFilter` - HTTP ìš”ì²­ ë¡œê¹… í•„í„°
- [ ] `MdcFilter` - MDC ì„¤ì • í•„í„°
- [ ] ELK Stack ì—°ë™ ì¤€ë¹„ (Logstash Encoder)

---

## âš ï¸ Phase 2 ì§„í–‰ ì¤‘: ê¸°ì¡´ ì½”ë“œ ì´ê´€ ë° ìˆ˜ì • í•„ìš”

### 2.1 build.gradle ì—…ë°ì´íŠ¸ ì™„ë£Œ âœ…
- âœ… `chat-message-server/build.gradle` - common ëª¨ë“ˆ ì˜ì¡´ì„± ë³€ê²½
- âœ… `chat-system-server/build.gradle` - common ëª¨ë“ˆ ì˜ì¡´ì„± ë³€ê²½
- âœ… `chat-websocket-server/build.gradle` - common ëª¨ë“ˆ ì˜ì¡´ì„± ë³€ê²½
- âœ… `chat-storage/build.gradle` - common-utilë§Œ ì˜ì¡´
- âœ… ë£¨íŠ¸ `build.gradle` - dependencyManagement í™œì„±í™”, Lombok ë²„ì „ ëª…ì‹œ

### 2.2 ì»´íŒŒì¼ ì—ëŸ¬ ë°œìƒ (ì˜ˆìƒë¨)
ë‹¤ìŒ íŒ¨í‚¤ì§€/í´ë˜ìŠ¤ê°€ ëˆ„ë½ë˜ì–´ ì»´íŒŒì¼ ì—ëŸ¬ ë°œìƒ:

#### chat-storage ëª¨ë“ˆ
- `com.example.chat.domain.entity.ChatMessage` â†’ ìƒˆë¡œ êµ¬í˜„ í•„ìš”
- `com.example.chat.domain.repository.MessageReader` â†’ ìƒˆë¡œ êµ¬í˜„ í•„ìš”
- `com.example.chat.domain.repository.MessageRepository` â†’ ìƒˆë¡œ êµ¬í˜„ í•„ìš”
- `com.example.chat.common.dto.UserId` â†’ `common-auth`ë¡œ ì´ë™ ì™„ë£Œ (import ê²½ë¡œë§Œ ìˆ˜ì • í•„ìš”)
- `com.example.chat.common.port.MessageReadRepository` â†’ ìƒˆë¡œ êµ¬í˜„ í•„ìš”

#### chat-websocket-server ëª¨ë“ˆ
- `com.example.chat.common.dto.ChatMessage` â†’ ìƒˆë¡œ êµ¬í˜„ í•„ìš”
- `com.example.chat.common.dto.UserId` â†’ `common-auth`ë¡œ ì´ë™ ì™„ë£Œ (import ê²½ë¡œë§Œ ìˆ˜ì • í•„ìš”)
- `com.example.chat.domain.service.register.ChatRoomRegister` â†’ ìƒˆë¡œ êµ¬í˜„ í•„ìš”

---

## ğŸ“‹ ë‹¤ìŒ ë‹¨ê³„: Phase 2 ì‘ì—… ê³„íš

### STEP 2: chat-storage ëª¨ë“ˆ DDD ê¸°ë°˜ ì¬êµ¬ì„±

#### 2.1 ë„ë©”ì¸ ëª¨ë¸ ìƒì„± (ìµœìš°ì„ )
**ìœ„ì¹˜**: `chat-storage/src/main/java/com/example/chat/storage/domain/`

**Message ë„ë©”ì¸**
```
domain/message/
â”œâ”€â”€ Message.java (Aggregate Root)
â”œâ”€â”€ MessageId.java (VO)
â”œâ”€â”€ MessageType.java (Enum: TEXT, IMAGE, FILE, VIDEO, AUDIO, SYSTEM, etc.)
â”œâ”€â”€ MessageContent.java (ì¸í„°í˜ì´ìŠ¤)
â”œâ”€â”€ MessageStatus.java (Enum: PENDING, SENT, DELIVERED, READ, FAILED)
â”œâ”€â”€ content/
â”‚   â”œâ”€â”€ TextMessageContent.java
â”‚   â”œâ”€â”€ ImageMessageContent.java
â”‚   â”œâ”€â”€ FileMessageContent.java
â”‚   â”œâ”€â”€ VideoMessageContent.java
â”‚   â””â”€â”€ RichContentMessageContent.java
â””â”€â”€ MessageRead.java
```

**Room ë„ë©”ì¸**
```
domain/room/
â”œâ”€â”€ ChatRoom.java (Aggregate Root)
â”œâ”€â”€ RoomId.java (VO)
â”œâ”€â”€ RoomType.java (Enum: DIRECT, GROUP, CHANNEL)
â”œâ”€â”€ Participant.java
â””â”€â”€ ParticipantRole.java (Enum: OWNER, ADMIN, MEMBER)
```

**Schedule ë„ë©”ì¸**
```
domain/schedule/
â”œâ”€â”€ ScheduleRule.java (Aggregate Root)
â”œâ”€â”€ ScheduleId.java (VO)
â”œâ”€â”€ ScheduleType.java (Enum: ONE_TIME, RECURRING)
â”œâ”€â”€ ScheduleStatus.java (Enum: ACTIVE, PAUSED, COMPLETED, CANCELLED)
â””â”€â”€ ScheduleExecutionLog.java
```

#### 2.2 ë©”ì‹œì§€ íƒ€ì… ì „ëµ íŒ¨í„´ êµ¬í˜„
**ìœ„ì¹˜**: `chat-storage/src/main/java/com/example/chat/storage/handler/`

```
handler/
â”œâ”€â”€ MessageHandler.java (ì¸í„°í˜ì´ìŠ¤)
â”œâ”€â”€ MessageHandlerRegistry.java (Registry)
â”œâ”€â”€ TextMessageHandler.java
â”œâ”€â”€ ImageMessageHandler.java
â”œâ”€â”€ FileMessageHandler.java
â””â”€â”€ ...
```

**ìœ„ì¹˜**: `chat-storage/src/main/java/com/example/chat/storage/factory/`

```
factory/
â””â”€â”€ MessageFactory.java (Factory íŒ¨í„´)
```

#### 2.3 Repository ì¸í„°í˜ì´ìŠ¤ ì •ì˜
**ìœ„ì¹˜**: `chat-storage/src/main/java/com/example/chat/storage/repository/`

```
repository/
â”œâ”€â”€ MessageRepository.java (ë„ë©”ì¸ ì¸í„°í˜ì´ìŠ¤)
â”œâ”€â”€ MessageReadRepository.java
â”œâ”€â”€ RoomRepository.java
â””â”€â”€ ScheduleRepository.java
```

#### 2.4 ê¸°ì¡´ Adapter í´ë˜ìŠ¤ ìˆ˜ì •
- `DomainMessageReaderAdapter.java` - import ê²½ë¡œ ìˆ˜ì •
- `DomainMessageRepositoryAdapter.java` - import ê²½ë¡œ ìˆ˜ì •
- `MessageReadRepositoryAdapter.java` - `UserId` import ê²½ë¡œ ìˆ˜ì •

### STEP 3: chat-websocket-server ìˆ˜ì •
- import ê²½ë¡œ ìˆ˜ì •: `com.example.chat.common.dto.UserId` â†’ `com.example.chat.common.auth.model.UserId`
- `ChatMessage` í´ë˜ìŠ¤ ì°¸ì¡° ìˆ˜ì • (chat-storage ë„ë©”ì¸ ëª¨ë¸ë¡œ)
- `ChatRoomRegister` êµ¬í˜„ ë˜ëŠ” ì œê±°

### STEP 4: chat-message-server ë° chat-system-server ìˆ˜ì •
- import ê²½ë¡œ ìˆ˜ì •
- ìƒˆë¡œìš´ ë„ë©”ì¸ ëª¨ë¸ ì‚¬ìš©

---

## ğŸ¯ í•µì‹¬ ì„¤ê³„ ì›ì¹™ (ì ìš© ì¤‘)

### DDD (Domain-Driven Design)
- âœ… Bounded Context ë¶„ë¦¬ (Messaging, ChatRoom, Schedule)
- âœ… Value Object ì‚¬ìš© (`UserId`, `MessageId`, `RoomId` ë“±)
- âœ… Aggregate Root ì‹ë³„ (`Message`, `ChatRoom`, `ScheduleRule`)
- ğŸ”„ ë„ë©”ì¸ ì´ë²¤íŠ¸ (ì§„í–‰ ì˜ˆì •)

### í™•ì¥ì„± ì„¤ê³„
- âœ… ì „ëµ íŒ¨í„´ (MessageHandler)
- âœ… íŒ©í† ë¦¬ íŒ¨í„´ (MessageFactory)
- âœ… ëª¨ë“ˆ ì„¸ë¶„í™” (common-util, common-auth, common-logging)
- âœ… Cursor ê¸°ë°˜ í˜ì´ì§• (ë¬´í•œ ìŠ¤í¬ë¡¤ ëŒ€ì‘)

### ì½”ë“œ ì»¨ë²¤ì…˜
- âœ… ë¶ˆë³€ ê°ì²´ ì‚¬ìš© (Value Object)
- âœ… ëª…í™•í•œ íŒ¨í‚¤ì§€ êµ¬ì¡°
- âœ… ì˜ì¡´ì„± ë°©í–¥ ì¤€ìˆ˜ (common â†’ storage â†’ servers)
- âœ… ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜ ì„¤ê³„

---

## ğŸ”§ ë¹Œë“œ ì„¤ì •

### Java Home
```
C:\Users\kimsungsig\.jdks\temurin-21.0.7
```

### ë¹Œë“œ ëª…ë ¹ì–´
```powershell
$env:JAVA_HOME = "C:\Users\kimsungsig\.jdks\temurin-21.0.7"
cd C:\git\chat-platform

# Common ëª¨ë“ˆë§Œ ë¹Œë“œ
.\gradlew :common-util:build :common-auth:build :common-logging:build -x test

# ì „ì²´ ë¹Œë“œ
.\gradlew clean build -x test
```

### ë¹Œë“œ ìƒíƒœ
- âœ… common-util: **BUILD SUCCESSFUL**
- âœ… common-auth: **BUILD SUCCESSFUL**
- âœ… common-logging: **BUILD SUCCESSFUL** (MdcUtil putTraceId/removeTraceId ì¶”ê°€)
- âœ… chat-storage: **BUILD SUCCESSFUL** (ë„ë©”ì¸ ëª¨ë¸ êµ¬í˜„ ì™„ë£Œ!)
- âœ… chat-system-server: **BUILD SUCCESSFUL** (Flyway ì˜ì¡´ì„± ìˆ˜ì • ì™„ë£Œ)
- ğŸ”„ chat-websocket-server: **ì§„í–‰ ì¤‘** (ë¬¸ì œ íŒŒì¼ ì„ì‹œ ë°±ì—… ì²˜ë¦¬)
- ğŸ”„ chat-message-server: **ì§„í–‰ ì¤‘** (ë¬¸ì œ íŒŒì¼ ì„ì‹œ ë°±ì—… ì²˜ë¦¬)

### ë°±ì—…ëœ íŒŒì¼ë“¤ (í–¥í›„ ì¬êµ¬í˜„ í•„ìš”)
**chat-websocket-server:**
- MessageBroadcaster.java.bak
- MessageEventListener.java.bak
- NotificationEventListener.java.bak
- RedisSubscriber.java.bak
- WebSocketPushService.java.bak

**chat-message-server:**
- ChatMessageMapper.java.bak
- MessageReadController.java.bak
- MessageDomainService.java.bak
- MessageDomainServiceImpl.java.bak
- MessagePublisher.java.bak
- MessageService.java.bak
- MessageServiceImpl.java.bak
- MessageSendFacade.java.bak
- MessageAppServiceImpl.java.bak
- RedisPublisher.java.bak

---

## ğŸ“ ì‘ì—… ìš°ì„ ìˆœìœ„

### ë†’ìŒ (ì¦‰ì‹œ ì§„í–‰)
1. **chat-storage ë„ë©”ì¸ ëª¨ë¸ êµ¬í˜„** (Message, Room, Schedule)
2. **MessageType ì „ëµ íŒ¨í„´ êµ¬í˜„** (í™•ì¥ì„± í•µì‹¬)
3. **Repository ì¸í„°í˜ì´ìŠ¤ ì •ì˜**

### ì¤‘ê°„ (ë„ë©”ì¸ ëª¨ë¸ ì™„ë£Œ í›„)
4. ê¸°ì¡´ Adapter í´ë˜ìŠ¤ import ê²½ë¡œ ìˆ˜ì •
5. chat-websocket-server import ê²½ë¡œ ìˆ˜ì •
6. chat-message-server, chat-system-server import ê²½ë¡œ ìˆ˜ì •

### ë‚®ìŒ (ê¸°ë³¸ ê¸°ëŠ¥ ì™„ë£Œ í›„)
7. common-auth JWT ê´€ë ¨ í´ë˜ìŠ¤ êµ¬í˜„
8. common-logging í•„í„° ë° ELK ì—°ë™ ì¤€ë¹„
9. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„±
10. í†µí•© í…ŒìŠ¤íŠ¸ ì‘ì„±

---

## ğŸ’¡ ë‹¤ìŒ ì„¸ì…˜ ì‹œì‘ í¬ì¸íŠ¸

**ëª…ë ¹ì–´ë¡œ ì¬ê°œ ì‹œ**:
```powershell
$env:JAVA_HOME = "C:\Users\kimsungsig\.jdks\temurin-21.0.7"
cd C:\git\chat-platform
```

**ë‹¤ìŒ ì‘ì—…**: `chat-storage` ëª¨ë“ˆì˜ ë„ë©”ì¸ ëª¨ë¸ (`Message`, `Room`, `Schedule`) êµ¬í˜„ë¶€í„° ì‹œì‘í•˜ë©´ ë©ë‹ˆë‹¤.

**ì°¸ê³  ë¬¸ì„œ**: `ì±„íŒ…_í”Œë«í¼_ì•„í‚¤í…ì²˜_ë°_ì„¤ê³„.md` ì„¹ì…˜ 11.3 (STEP 2)

---

## ğŸ“š ì°¸ê³  ìë£Œ

### ìƒì„±ëœ ë¬¸ì„œ
- `ì±„íŒ…_í”Œë«í¼_ì•„í‚¤í…ì²˜_ë°_ì„¤ê³„.md` - ì „ì²´ ì•„í‚¤í…ì²˜ ì„¤ê³„ ë¬¸ì„œ

### ì£¼ìš” ì˜ì¡´ì„± ë²„ì „
- Spring Boot: 3.5.6
- Java: 21 (Temurin)
- Lombok: 1.18.36
- Jackson: 2.18.2
- JWT: 0.12.3
- SLF4J: 2.0.16

---

**ë¬¸ì„œ ì¢…ë£Œ**
