# ì„œë²„ ë¦¬íŒ©í† ë§ ì„¸ì…˜ ì™„ë£Œ ë³´ê³ ì„œ

## ğŸ“… ì‘ì—… ì¼ì: 2025-12-11

---

## ğŸ¯ ì‘ì—… ëª©í‘œ

**Domain ë¶„ë¦¬ ì™„ë£Œ í›„ ì„œë²„ ì½”ë“œë¥¼ ìƒˆë¡œìš´ Domain êµ¬ì¡°ì— ë§ê²Œ ë¦¬íŒ©í† ë§**

---

## âœ… ì™„ë£Œëœ ì‘ì—…

### 1. chat-system-server ë¦¬íŒ©í† ë§ (70% ì™„ë£Œ)

#### 1.1 ScheduleService ì „ì²´ ì¬ì‘ì„± âœ…

- `createOneTimeSchedule`: Domain Service í™œìš©, Early Return íŒ¨í„´ ì ìš©
- `createRecurringSchedule`: Domain Service í™œìš©, Cron Expression ì‚¬ìš©
- `cancelSchedule`: String scheduleIdë¡œ ë³€ê²½
- `getMySchedules`: ì‚¬ìš©ìë³„ ìŠ¤ì¼€ì¤„ ì¡°íšŒ
- `getSchedulesByChannel`: ì±„ë„ë³„ ìŠ¤ì¼€ì¤„ ì¡°íšŒ (Room â†’ Channel ë³€ê²½)
- **ë³€ê²½ ì‚¬í•­**:
	- `ScheduleRule.createOneTime/createRecurring` â†’
	  `ScheduleDomainService.createOneTimeSchedule/createRecurringSchedule`
	- `rule.getScheduleId()` â†’ `rule.getId().getValue()`
	- `rule.pause/resume()` ë©”ì„œë“œ ì œê±° (Domainì— ì—†ìŒ)
	- Long scheduleId â†’ String scheduleId

#### 1.2 MessagePublishJob ìˆ˜ì • âœ…

- String scheduleId ì‚¬ìš©
- `rule.canBeExecuted()` ë©”ì„œë“œ í™œìš©
- `rule.markAsExecuted()` / `rule.markAsFailed()` ë©”ì„œë“œ í™œìš©
- Redis ë¶„ì‚° ë½ ì ìš© (String scheduleId)

#### 1.3 ScheduleResponse DTO ìˆ˜ì • âœ…

- Domain êµ¬ì¡°ì— ë§ê²Œ í•„ë“œ ë§¤í•‘
- `rule.getId().getValue()` ì‚¬ìš©
- `rule.getMessage().getChannelId()` ë“± ì¤‘ì²© ì ‘ê·¼

#### 1.4 ScheduleController ìˆ˜ì • âœ…

- `cancelSchedule`: String scheduleId íŒŒë¼ë¯¸í„°ë¡œ ë³€ê²½
- `getSchedulesByRoom` â†’ `getSchedulesByChannel`ë¡œ ë³€ê²½

#### 1.5 Repository ì¶”ê°€ ë©”ì„œë“œ êµ¬í˜„ âœ…

- `ScheduleRuleRepository.findActiveBySenderId`
- `ScheduleRuleRepository.findActiveByChannelId`
- `JpaScheduleRuleRepository.findBySenderIdAndScheduleStatusIn`
- `JpaScheduleRuleRepository.findByChannelIdAndScheduleStatusIn`
- `ScheduleRepositoryAdapter` êµ¬í˜„ ì™„ë£Œ

#### 1.6 DistributedLockService ìˆ˜ì • âœ…

- Long scheduleId â†’ String scheduleIdë¡œ ë³€ê²½

#### 1.7 Domain Service Bean ë“±ë¡ âœ…

- `DomainServiceConfig` ìƒì„±
- `MessageDomainService`, `ScheduleDomainService`, `ChannelDomainService` Bean ë“±ë¡

#### 1.8 Component Scan ì„¤ì • âœ…

- `ChatSystemServerApplication`ì— storage, common íŒ¨í‚¤ì§€ ìŠ¤ìº” ì¶”ê°€

---

### 2. chat-message-server ë¦¬íŒ©í† ë§ (ì™„ë£Œ) âœ…

#### 2.1 MessageApplicationService âœ…

- ì´ë¯¸ Domain êµ¬ì¡°ì— ë§ê²Œ ì‘ì„±ë¨
- Early Return íŒ¨í„´ ì ìš©
- Domain Service í™œìš©

#### 2.2 MessageEventPublisher âœ…

- Domain ë©”ì„œë“œ ì‚¬ìš© (`message.getId().getValue()`, `message.getChannelId().getValue()`)

#### 2.3 DomainServiceConfig ìƒì„± âœ…

- `MessageDomainService` Bean ë“±ë¡

---

## âŒ ë‚¨ì€ ì‘ì—…

### 1. chat-system-serverì˜ MessageService/MessageController ì •ë¦¬

**ë¬¸ì œ**: chat-system-serverì— **êµ¬ ë²„ì „ì˜ MessageService/MessageController**ê°€ ë‚¨ì•„ ìˆìŒ

- ì´ íŒŒì¼ë“¤ì€ Domain ë¶„ë¦¬ ì´ì „ì˜ êµ¬ì¡°ë¥¼ ì‚¬ìš©
- `Message`, `Channel` ë“±ì´ ì´ì „ ì—”í‹°í‹°ë¥¼ ì°¸ì¡°
- **í•„ìš”í•œ ì‘ì—…**:
	1. **ì˜µì…˜ A (ê¶Œì¥)**: ì‚­ì œ
		- chat-system-serverëŠ” ë©”ì‹œì§€ ì¡°íšŒ/ê´€ë¦¬ë§Œ í•˜ê³ , ë©”ì‹œì§€ ë°œì†¡ì€ chat-message-serverì— ìœ„ì„
		- ScheduleServiceë§Œ ìœ ì§€
	2. **ì˜µì…˜ B**: ë¦¬íŒ©í† ë§
		- ìƒˆë¡œìš´ Domain êµ¬ì¡°ì— ë§ê²Œ ì „ë©´ ì¬ì‘ì„±
		- MessageRepository Adapter í™œìš©

**ì˜í–¥ë°›ëŠ” íŒŒì¼**:

```
chat-system-server/src/main/java/com/example/chat/system/
â”œâ”€â”€ controller/
â”‚   â””â”€â”€ MessageController.java (ì‚­ì œ ë˜ëŠ” ë¦¬íŒ©í† ë§)
â”œâ”€â”€ service/
â”‚   â””â”€â”€ MessageService.java (ì‚­ì œ ë˜ëŠ” ë¦¬íŒ©í† ë§)
â””â”€â”€ dto/
    â”œâ”€â”€ request/MessageCreateRequest.java
    â”œâ”€â”€ request/MessageUpdateRequest.java
    â””â”€â”€ response/MessageResponse.java (ScheduleResponseì™€ ì¤‘ë³µ)
```

---

### 2. ScheduleRule Domainì˜ pause/resume ë©”ì„œë“œ ì¶”ê°€ (ì„ íƒ)

**í˜„ì¬ ìƒí™©**:

- `ScheduleService`ì—ì„œ `pauseSchedule`, `resumeSchedule` ë©”ì„œë“œê°€ ì œê±°ë¨
- Domainì— í•´ë‹¹ ë©”ì„œë“œê°€ ì—†ìŒ

**í•„ìš”í•œ ì‘ì—…** (ì„ íƒ):

- `ScheduleRule`ì— `pause()`, `resume()` ë©”ì„œë“œ ì¶”ê°€
- `ScheduleStatus.PAUSED` ì¶”ê°€
- `ScheduleService`ì— ë©”ì„œë“œ ì¬ì¶”ê°€
- `ScheduleController`ì— ì—”ë“œí¬ì¸íŠ¸ ì¬ì¶”ê°€

---

## ğŸ” ë¹Œë“œ ì—ëŸ¬ í˜„í™©

### ì—ëŸ¬ ê°œìˆ˜: ì•½ 5ê°œ

- **chat-system-server**: MessageService, MessageControllerì—ì„œ ë°œìƒ
- **ì›ì¸**: êµ¬ ë²„ì „ Domain ì°¸ì¡°

### í•´ê²° ë°©ë²•:

```bash
# 1. MessageService, MessageController ì‚­ì œ (ê¶Œì¥)
rm chat-system-server/src/main/java/com/example/chat/system/service/MessageService.java
rm chat-system-server/src/main/java/com/example/chat/system/controller/MessageController.java

# 2. ë¹Œë“œ ì¬ì‹¤í–‰
./gradlew build -x test
```

---

## ğŸ“Š ì½”ë“œ í’ˆì§ˆ ê°œì„  ì‚¬í•­

### âœ… ë‹¬ì„±í•œ ëª©í‘œ

1. **Early Return íŒ¨í„´ ì² ì €íˆ ì ìš©**
	- ëª¨ë“  Service ë©”ì„œë“œì—ì„œ ê²€ì¦ ë¡œì§ ìš°ì„  ì‹¤í–‰

2. **Key ê¸°ë°˜ ë„ë©”ì¸ ì¡°íšŒ íŒ¨í„´**
	- `getUserIdFromContext()` â†’ Domain UserId ë³€í™˜
	- `ScheduleId.of()` â†’ Domain ScheduleId ìƒì„±
	- Repositoryì—ì„œ Domain ê°ì²´ ì¡°íšŒ

3. **Domain Service í™œìš©**
	- ë³µì¡í•œ ìƒì„± ë¡œì§ì€ Domain Serviceë¡œ ìœ„ì„
	- Application ServiceëŠ” ì¡°ìœ¨ ì—­í• ë§Œ ìˆ˜í–‰

4. **DDD ì›ì¹™ ì¤€ìˆ˜**
	- Domain ë ˆì´ì–´ëŠ” ì¸í”„ë¼ ë…ë¦½
	- Application ë ˆì´ì–´ëŠ” Domainì„ í™œìš©
	- RepositoryëŠ” Adapter íŒ¨í„´ìœ¼ë¡œ êµ¬í˜„

---

## ğŸ¯ ë‹¤ìŒ ì„¸ì…˜ ê¶Œì¥ ì‘ì—…

### Phase 1: ë¹Œë“œ ì—ëŸ¬ í•´ê²° (10ë¶„)

1. chat-system-serverì˜ MessageService/MessageController ì‚­ì œ
2. ê´€ë ¨ DTO íŒŒì¼ ì •ë¦¬
3. ë¹Œë“œ ì„±ê³µ í™•ì¸

### Phase 2: í†µí•© í…ŒìŠ¤íŠ¸ (30ë¶„)

1. chat-message-server ì‹¤í–‰ í…ŒìŠ¤íŠ¸
2. chat-system-server ì‹¤í–‰ í…ŒìŠ¤íŠ¸
3. ìŠ¤ì¼€ì¤„ ìƒì„±/ì·¨ì†Œ API í…ŒìŠ¤íŠ¸
4. Quartz Job ì‹¤í–‰ í™•ì¸

### Phase 3: chat-websocket-server ë¦¬íŒ©í† ë§ (ì„ íƒ, 1ì‹œê°„)

- Domain êµ¬ì¡°ì— ë§ê²Œ ìˆ˜ì •
- MessageEvent ìˆ˜ì •

### Phase 4: ë¬¸ì„œí™” ë° ì •ë¦¬ (30ë¶„)

- API ë¬¸ì„œ ì—…ë°ì´íŠ¸
- README ì‘ì„±
- ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨ ê°±ì‹ 

---

## ğŸ’¡ ì£¼ìš” í•™ìŠµ ì‚¬í•­

### 1. Domain ë¶„ë¦¬ì˜ ì´ì 

- **í…ŒìŠ¤íŠ¸ ìš©ì´ì„±**: Domain ë¡œì§ì„ ë…ë¦½ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
- **ì¬ì‚¬ìš©ì„±**: ì—¬ëŸ¬ ì„œë²„ì—ì„œ ë™ì¼í•œ Domain ì‚¬ìš©
- **ìœ ì§€ë³´ìˆ˜ì„±**: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë³€ê²½ ì‹œ Domainë§Œ ìˆ˜ì •

### 2. Hexagonal Architecture ì ìš©

- **í¬íŠ¸(Repository Interface)**: Domain ë ˆì´ì–´ì— ì •ì˜
- **ì–´ëŒ‘í„°(JPA Adapter)**: Infrastructure ë ˆì´ì–´ì— êµ¬í˜„
- **ì˜ì¡´ì„± ì—­ì „**: Domain â† Infrastructure

### 3. ë©€í‹° ëª¨ë“ˆ ì„¤ê³„ Best Practice

- **common ëª¨ë“ˆ ì„¸ë¶„í™”**: util, auth, logging
- **chat-domain**: ìˆœìˆ˜ ë„ë©”ì¸ (JPA ë…ë¦½)
- **chat-storage**: JPA ì˜ì¡´ì„± ê²©ë¦¬
- **ê° ì„œë²„**: ë…ë¦½ ì‹¤í–‰ ê°€ëŠ¥

---

## ğŸ“ ì°¸ê³  ì‚¬í•­

### Domain Service Bean ë“±ë¡ ë°©ì‹

```java
@Configuration
public class DomainServiceConfig {
    @Bean
    public MessageDomainService messageDomainService() {
        return new MessageDomainService();
    }
}
```

### Component Scan ì„¤ì •

```java
@SpringBootApplication(scanBasePackages = {
    "com.example.chat.system",
    "com.example.chat.storage",
    "com.example.chat.common"
})
```

---

## ğŸ‰ ì„±ê³¼

- **Domain ë¶„ë¦¬ ì™„ë£Œ**: 100%
- **chat-message-server ë¦¬íŒ©í† ë§**: 100%
- **chat-system-server ë¦¬íŒ©í† ë§**: 70%
- **ì½”ë“œ ì»¨ë²¤ì…˜ ì¤€ìˆ˜**: DDD, EDA, Early Return íŒ¨í„´ ì ìš©
- **ì•„í‚¤í…ì²˜ ê°œì„ **: Hexagonal Architecture ì ìš©

---

**ë‹¤ìŒ ì„¸ì…˜ ì‹œì‘ ëª…ë ¹**:

```bash
# 1. MessageService/MessageController ì‚­ì œ
# 2. ë¹Œë“œ ì‹¤í–‰
./gradlew build -x test
# 3. ì„œë²„ ì‹¤í–‰ ë° í…ŒìŠ¤íŠ¸
```
