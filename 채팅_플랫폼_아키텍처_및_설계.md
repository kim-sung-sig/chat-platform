# ì±„íŒ… í”Œë«í¼ ì•„í‚¤í…ì²˜ ë° ì„¤ê³„

> ì´ ë¬¸ì„œëŠ” ê¸°ì¡´ `ì±„íŒ…_ì–´í”Œë¦¬ì¼€ì´ì…˜_ì•„í‚¤í…ì²˜_ë°_ê¸°íšì„œ.md`ì™€ ìµœê·¼ì— ì •ë¦¬í•œ `ì±„íŒ…_ì–´í”Œë¦¬ì¼€ì´ì…˜_ì¬ì„¤ê³„_ì•„í‚¤í…ì²˜_ë¬¸ì„œ_ì´ˆì•ˆ.md`ë¥¼ ë°”íƒ•ìœ¼ë¡œ, ì‹¤ì œ êµ¬í˜„ì„ ìœ„í•œ ì¬ì„¤ê³„ ê²°ê³¼ë¥¼ ì •ë¦¬í•œ ë¬¸ì„œì…ë‹ˆë‹¤.

## 1. ê°œìš”

- ëª©í‘œ
  - DDD(Domain-Driven Design) + EDA(Event-Driven Architecture)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ì±„íŒ… í”Œë«í¼ì„ ì„¤ê³„í•œë‹¤.
  - ë©€í‹° ëª¨ë“ˆ Gradle í”„ë¡œì íŠ¸ êµ¬ì¡°ë¥¼ ì •ë¦¬í•˜ê³ , ì‹¤í–‰ ì¸ìŠ¤í„´ìŠ¤ë³„ ì±…ì„ê³¼ ê²½ê³„ë¥¼ ëª…í™•íˆ í•œë‹¤.
  - ì±„íŒ…ë°© ê´€ë¦¬, ì±„íŒ… ë©”ì‹œì§€ ë°œí–‰/ì €ì¥/ì „íŒŒ, ì˜ˆì•½ ë©”ì‹œì§€, ë‹¤ì–‘í•œ ë©”ì‹œì§€ íƒ€ì…, SaaS í™•ì¥ ê°€ëŠ¥ì„±ì„ ê³ ë ¤í•œë‹¤.
- ì‹¤í–‰ ì¸ìŠ¤í„´ìŠ¤(ì„œë²„ í”„ë¡œì„¸ìŠ¤)
  - `chat-message-server`
  - `chat-system-server`
  - `chat-websocket-server`
- ë¼ì´ë¸ŒëŸ¬ë¦¬/ì„œí¬íŠ¸ ëª¨ë“ˆ
  - `common` (ê¸°ì¡´ `chat-common` ì¬êµ¬ì„±)
  - `chat-storage`
  - (ì„ íƒ) `security`, `room-storage` ë“±

ì´í•˜ ì„¹ì…˜ì—ì„œ ë©€í‹° ëª¨ë“ˆ êµ¬ì¡°, DDD ê´€ì  Bounded Context, ì´ë²¤íŠ¸ íë¦„, ëª¨ë“ˆë³„ ì£¼ìš” í”Œë¡œìš°, ì €ì¥ì†Œ ë° SaaS ì „ëµì„ ìˆœì„œëŒ€ë¡œ ì„¤ëª…í•œë‹¤.

---

## 2. ë©€í‹° ëª¨ë“ˆ êµ¬ì¡° ë° ì˜ì¡´ì„±

### 2.1. ì „ì²´ ëª¨ë“ˆ êµ¬ì¡°

- ë£¨íŠ¸ í”„ë¡œì íŠ¸: `chat-platform`
- ì„œë¸Œ ëª¨ë“ˆ ê°œìš”
  - ì‹¤í–‰ ëª¨ë“ˆ (Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜)
    - `chat-message-server`
    - `chat-system-server`
    - `chat-websocket-server`
  - ë¼ì´ë¸ŒëŸ¬ë¦¬/ì„œí¬íŠ¸ ëª¨ë“ˆ
    - `common` (ê¸°ì¡´ `chat-common` ì—ì„œ ì¬êµ¬ì„±)
    - `chat-storage`
    - (ì„ íƒ) `security`, `room-storage` ë“±

### 2.2. ëª¨ë“ˆë³„ ì—­í• 

#### 2.2.1. `common` (ê³µí†µ ë¼ì´ë¸ŒëŸ¬ë¦¬ ëª¨ë“ˆ ê·¸ë£¹)

- ì„±ê²©: ìˆœìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ëª¨ë“ˆ ê·¸ë£¹ (ì–´ëŠ ì‹¤í–‰ ëª¨ë“ˆì—ì„œë„ ê³µí†µìœ¼ë¡œ ì‚¬ìš©)
- êµ¬ì„±: 3ê°œì˜ ì„œë¸Œ ëª¨ë“ˆë¡œ ì„¸ë¶„í™”
  - `common-util`
  - `common-auth`
  - `common-logging`

**A. `common-util`**
- ì±…ì„
  - ê³µí†µ ì˜ˆì™¸ ê³„ì¸µ
    - `BaseException`, `BaseErrorCode`, `ErrorCode` enum
    - `GlobalExceptionHandler` (Spring MVC ê¸°ë°˜)
  - ê³µí†µ ìƒìˆ˜
    - HTTP í—¤ë” ì´ë¦„, ê¸°ë³¸ í˜ì´ì§€ í¬ê¸°, ê³µí†µ ì—ëŸ¬ ë©”ì‹œì§€, ì‹œìŠ¤í…œ ìƒìˆ˜ ë“±
  - ê³µí†µ ìœ í‹¸ë¦¬í‹°
    - ë‚ ì§œ/ì‹œê°„ ì²˜ë¦¬ (`DateTimeUtil`)
    - ID ìƒì„± (`IdGenerator`, UUID/Snowflake ë“±)
    - Validation Helper
    - ë¬¸ìì—´/ì»¬ë ‰ì…˜ ìœ í‹¸
    - Cursor ê´€ë ¨ ìœ í‹¸ (`CursorCodec`, `Cursor`)
- ì˜ì¡´ì„±
  - ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ìµœì†Œí™” (ìˆœìˆ˜ Java + Lombok ì •ë„)
  - Spring Framework (ì˜ˆì™¸ ì²˜ë¦¬ ë“± í•„ìš” ì‹œ)

**B. `common-auth`**
- ì±…ì„
  - ì¸ì¦/ì¸ê°€ ê´€ë ¨ ê³µí†µ ë¡œì§
    - JWT í† í° ìƒì„±/ê²€ì¦ (`JwtTokenProvider`)
    - í† í° íŒŒì‹± ë° Claim ì¶”ì¶œ
    - ì‚¬ìš©ì ì¸ì¦ ì •ë³´ ê°ì²´ (`AuthUser`, `UserPrincipal`)
    - Spring Security í†µí•© (Filter, Authentication ë“±)
  - íšŒì›/ì‚¬ìš©ì ì‹ë³„ ê´€ë ¨
    - `UserId` (Value Object)
    - ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸ í™€ë” (`UserContextHolder`, ThreadLocal ê¸°ë°˜)
  - ê¶Œí•œ ì²´í¬ ì–´ë…¸í…Œì´ì…˜ ë° AOP
    - `@RequireAuth`, `@RequireRole` ë“±
- ì˜ì¡´ì„±
  - `common-util` (ì˜ˆì™¸, ìƒìˆ˜ ë“±)
  - Spring Security
  - JWT ë¼ì´ë¸ŒëŸ¬ë¦¬ (ì˜ˆ: jjwt)

**C. `common-logging`**
- ì±…ì„
  - ë¡œê¹… ê´€ë ¨ ê³µí†µ ìœ í‹¸ë¦¬í‹° ë° ì„¤ì •
    - MDC ì²˜ë¦¬ ìœ í‹¸ (`MdcUtil`)
    - ê³µí†µ HTTP ìš”ì²­ ë¡œê¹… í•„í„° (`RequestLoggingFilter`)
    - TraceId, SpanId ìƒì„± ë° ì „íŒŒ
    - êµ¬ì¡°í™” ë¡œê·¸ í¬ë§· ì •ì˜
  - í–¥í›„ í™•ì¥
    - ELK Stack, Grafana Loki ë“± ì¤‘ì•™ ë¡œê·¸ ìˆ˜ì§‘ ì‹œìŠ¤í…œ ì—°ë™ ëŒ€ë¹„
    - OpenTelemetry í†µí•© (ë¶„ì‚° ì¶”ì )
  - **í˜„ì¬ëŠ” ë°”ë¡œ êµ¬í˜„í•˜ì§€ ì•Šê³ , ì¶”í›„ ELK Stack ë“±ìœ¼ë¡œ ì „í™˜í•  ë•Œ ë³¸ê²© êµ¬í˜„ ì˜ˆì •**
- ì˜ì¡´ì„±
  - `common-util` (ìƒìˆ˜ ë“±)
  - SLF4J, Logback
  - (í–¥í›„) Logstash Encoder, OpenTelemetry SDK

**ì˜ì¡´ì„± ë°©í–¥**
```
common-util (ìµœí•˜ìœ„)
    â†‘
    â”œâ”€â”€ common-auth
    â””â”€â”€ common-logging

ì‹¤í–‰ ëª¨ë“ˆë“¤ â†’ í•„ìš”í•œ common ì„œë¸Œ ëª¨ë“ˆë§Œ ì„ íƒì ìœ¼ë¡œ ì˜ì¡´
```

**ì˜ì¡´ì„± ì •ì±…**
- `common` ì„œë¸Œ ëª¨ë“ˆë“¤ì€ ë‹¤ë¥¸ í”„ë¡œì íŠ¸ ëª¨ë“ˆ(`chat-storage`, ì‹¤í–‰ ì„œë²„ ë“±)ì— ì˜ì¡´í•˜ì§€ ì•ŠëŠ”ë‹¤.
- ëª¨ë“  ì‹¤í–‰ ëª¨ë“ˆì€ í•„ìš”í•œ `common` ì„œë¸Œ ëª¨ë“ˆì— ì˜ì¡´í•  ìˆ˜ ìˆì§€ë§Œ, ì‹¤í–‰ ëª¨ë“ˆë¼ë¦¬ ì§ì ‘ ìˆœí™˜ ì˜ì¡´í•˜ì§€ ì•Šë„ë¡ ì„¤ê³„í•œë‹¤.
- `common-util`ì„ ê¸°ë°˜ìœ¼ë¡œ `common-auth`, `common-logging`ì´ í™•ì¥í•˜ëŠ” êµ¬ì¡°

#### 2.2.2. `chat-storage`

- ì„±ê²©: ë„ë©”ì¸ ì—”í‹°í‹° ë° ì˜ì†ì„± ê³„ì¸µ ëª¨ë“ˆ
- ì±…ì„
  - ì±„íŒ… ë„ë©”ì¸ ê´€ë ¨ ëª¨ë“  Entity, Repository, JPA ì„¤ì •
  - ë„ë©”ì¸ë³„ íŒ¨í‚¤ì§€ êµ¬ì¡° (ì˜ˆì‹œ)
    - `room`/`channel`: ì±„íŒ…ë°©, ì±„ë„, ì°¸ì—¬ì
    - `message`: ë©”ì‹œì§€, ë©”ì‹œì§€ ìƒíƒœ, ë©”ì‹œì§€ ì½ìŒ ì •ë³´
    - `schedule`: ì˜ˆì•½ ë©”ì‹œì§€ ê·œì¹™, ìŠ¤ì¼€ì¤„ ì‹¤í–‰ ë¡œê·¸
  - CQRS(Read/Write ë¶„ë¦¬)ë¥¼ ê³ ë ¤í•œ ëª¨ë¸ êµ¬ì„±
- ì‚¬ìš©
  - `chat-message-server`, `chat-system-server` ì—ì„œ ì£¼ì… ë°›ì•„ ì‚¬ìš©
  - (í•„ìš” ì‹œ) `chat-websocket-server` ê°€ ì½ê¸° ì „ìš© ì¡°íšŒì— ì‚¬ìš© ê°€ëŠ¥

#### 2.2.3. `chat-message-server`

- ì„±ê²©: ë©”ì‹œì§€ ë°œì†¡/ì €ì¥ API ì„œë²„ (ì‹¤í–‰ ëª¨ë“ˆ)
- ì±…ì„
  - ì™¸ë¶€/ë‚´ë¶€ í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ë‹¤ì–‘í•œ í˜•íƒœì˜ ë©”ì‹œì§€ ë°œì†¡ ìš”ì²­ì„ ìˆ˜ì‹  (REST API)
  - ë©”ì‹œì§€ ê²€ì¦ ë° ì „ì²˜ë¦¬ (ê¶Œí•œ, í¬ë§·, ë¹„ì¦ˆë‹ˆìŠ¤ Rule)
  - `chat-storage` ë¥¼ ì´ìš©í•˜ì—¬ ë©”ì‹œì§€ ë° ê´€ë ¨ ì •ë³´ë¥¼ ì €ì¥
  - Redis Pub/Sub ì„ í†µí•´ ì—¬ëŸ¬ ì¸ìŠ¤í„´ìŠ¤ì˜ `chat-websocket-server` ì— ë©”ì‹œì§€ ì „íŒŒ
  - ë©”ì‹œì§€ ì½ìŒ ì²˜ë¦¬ ë° ì¡°íšŒ API (ì˜ˆ: `MessageReadController` ì™€ ê°™ì€ ì—­í• )
- ì˜ì¡´ì„±
  - `common`
  - `chat-storage`
  - `security` (JWT ì¸ì¦/ì¸ê°€ ë“±)

#### 2.2.4. `chat-system-server`

- ì„±ê²©: ì±„íŒ… ì‹œìŠ¤í…œ ê´€ë¦¬/ë¹„ì¦ˆë‹ˆìŠ¤ API ì„œë²„ (ì‹¤í–‰ ëª¨ë“ˆ)
- ì±…ì„
  - ì±„íŒ…ë°© / ì±„ë„ ìƒì„±, ìˆ˜ì •, ì‚­ì œ
  - ì±„íŒ…ë°© ì°¸ì—¬/íƒˆí‡´, ì´ˆëŒ€ ë“± ê´€ë¦¬ ê¸°ëŠ¥
  - ì±„íŒ… ë©”ì‹œì§€ ì¡°íšŒ API
    - Offset ê¸°ë°˜ì´ ì•„ë‹Œ **Cursor ê¸°ë°˜ í˜ì´ì§•**ìœ¼ë¡œ ë©”ì‹œì§€ ëª©ë¡ ì œê³µ
  - ì˜ˆì•½ ë©”ì‹œì§€(ìŠ¤ì¼€ì¤„) ë“±ë¡/ìˆ˜ì •/ì·¨ì†Œ/ì¡°íšŒ
  - ì˜ˆì•½ ë©”ì‹œì§€ ì‹¤í–‰ ë¡œì§ ì œì–´ (ìŠ¤ì¼€ì¤„ëŸ¬ì™€ì˜ ì—°ê³„ í¬í•¨)
  - í•„ìš” ì‹œ `chat-message-server` ë¥¼ í†µí•´ ì‹¤ì œ ë©”ì‹œì§€ ë°œì†¡ íŠ¸ë¦¬ê±°
- ì˜ì¡´ì„±
  - `common`
  - `chat-storage`
  - (í†µì‹  ë°©ì‹ì— ë”°ë¼) `chat-message-server` ì™€ì˜ REST í˜¸ì¶œ ë˜ëŠ” ì´ë²¤íŠ¸ ì—°ë™

#### 2.2.5. `chat-websocket-server`

- ì„±ê²©: WebSocket ì „ìš© ì„œë²„ (ì‹¤í–‰ ëª¨ë“ˆ)
- ì±…ì„
  - WebSocket ì—°ê²° ìˆ˜ë¦½/í•´ì œ ë° ì„¸ì…˜ ê´€ë¦¬
  - íŠ¹ì • ì±„ë„/ì‚¬ìš©ìì— ëŒ€í•œ ë©”ì‹œì§€ push
  - Redis Pub/Sub êµ¬ë…ì„ í†µí•´ `chat-message-server` ê°€ ë°œí–‰í•œ ë©”ì‹œì§€ë¥¼ ìˆ˜ì‹  í›„, ì ì ˆí•œ WebSocket ì„¸ì…˜ì— ë§¤í•‘í•˜ì—¬ ì „ì†¡
  - ì•Œë¦¼/ì „íŒŒ ë©”ì‹œì§€ ì²˜ë¦¬, ë¸Œë¡œë“œìºìŠ¤íŠ¸/ë©€í‹°ìºìŠ¤íŠ¸/ìœ ì € ë‹¨ìœ„ ì „ì†¡
- ì˜ì¡´ì„±
  - `common`
  - `security`
  - (ì„ íƒ) `room-storage` ë˜ëŠ” `chat-storage` ì˜ ì¼ë¶€ ì½ê¸° ì „ìš© ì‚¬ìš©

### 2.3. ëª¨ë“ˆ ê°„ ì˜ì¡´ì„± ë°©í–¥

- `common` > (ëª¨ë“  ì‹¤í–‰ ëª¨ë“ˆ)
- `chat-storage` > `chat-message-server`, `chat-system-server`, (ì„ íƒ) `chat-websocket-server`
- `chat-message-server`, `chat-system-server`, `chat-websocket-server` ëŠ” ì„œë¡œ ì§ì ‘ ìˆœí™˜ ì˜ì¡´í•˜ì§€ ì•Šë„ë¡ í•œë‹¤.
  - `chat-system-server` ê°€ ë©”ì‹œì§€ ë°œì†¡ì„ ìš”ì²­í•  ë•ŒëŠ” REST í˜¸ì¶œ ë˜ëŠ” ì´ë²¤íŠ¸ ë°œí–‰ì„ í†µí•´ `chat-message-server` ë¥¼ ê°„ì ‘ì ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤.

---

## 3. DDD ê´€ì  ì„¤ê³„

### 3.1. Bounded Context ì •ì˜

ì£¼ìš” Bounded Context ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì •ì˜í•œë‹¤.

1. **Messaging BC**
   - ë²”ìœ„: ë©”ì‹œì§€ ë°œì†¡/ì €ì¥/ì „íŒŒ
   - ì£¼ìš” ëª¨ë“ˆ: `chat-message-server`, `chat-storage.message`
   - ì±…ì„
     - ë©”ì‹œì§€ ì—”í‹°í‹° ê´€ë¦¬ (ë³¸ë¬¸, ì²¨ë¶€, ë©”íƒ€ë°ì´í„°, ìƒíƒœ)
     - ë©”ì‹œì§€ ë°œí–‰/ì €ì¥ íŠ¸ëœì­ì…˜ ì²˜ë¦¬
     - ë©”ì‹œì§€ ì „ë‹¬ ì´ë²¤íŠ¸ ë°œí–‰ (Redis Pub/Sub, Outbox ë“±)

2. **ChatRoom BC**
   - ë²”ìœ„: ì±„íŒ…ë°©, ì±„ë„, ì°¸ì—¬ì ê´€ë¦¬
   - ì£¼ìš” ëª¨ë“ˆ: `chat-system-server`, `chat-storage.room/channel`
   - ì±…ì„
     - ì±„íŒ…ë°©/ì±„ë„ ìƒì„±, ì†ì„± ë³€ê²½, ì‚­ì œ
     - ë°© ì°¸ì—¬/íƒˆí‡´, ê¶Œí•œ ê´€ë¦¬

3. **Schedule BC**
   - ë²”ìœ„: ì˜ˆì•½ ë©”ì‹œì§€ ìŠ¤ì¼€ì¤„ ê´€ë¦¬
   - ì£¼ìš” ëª¨ë“ˆ: `chat-system-server`, `chat-storage.schedule`
   - ì±…ì„
     - ë‹¨ë°œ/ì£¼ê¸° ìŠ¤ì¼€ì¤„ ê·œì¹™(ScheduleRule) ê´€ë¦¬
     - ìŠ¤ì¼€ì¤„ ìƒíƒœ(ScheduleState) ë° ì‹¤í–‰ ì´ë ¥ ê´€ë¦¬
     - ìŠ¤ì¼€ì¤„ì— ë”°ë¥¸ ë©”ì‹œì§€ ë°œì†¡ íŠ¸ë¦¬ê±° (ì£¼ë¡œ `chat-message-server` ì™€ ì—°ë™)

4. **User/Member BC** (ì™¸ë¶€ ì‹œìŠ¤í…œê³¼ ì—°ë™ ê°€ì •)
   - ë²”ìœ„: ì‚¬ìš©ì/íšŒì›
   - ì´ ì‹œìŠ¤í…œì—ì„œëŠ” ì£¼ë¡œ ì‚¬ìš©ì ì‹ë³„ì/í”„ë¡œí•„ ì •ë„ë§Œ ì°¸ì¡°í•˜ê³ , ì¸ì¦/íšŒì› ê°€ì…ì€ ì™¸ë¶€ ì„œë¹„ìŠ¤ì— ìœ„ì„í•˜ëŠ” ê²ƒì„ ê¸°ë³¸ ê°€ì •ìœ¼ë¡œ í•œë‹¤.

### 3.2. ë„ë©”ì¸ ëª¨ë¸ ê°œëµ

ì˜ˆì‹œ ìˆ˜ì¤€ìœ¼ë¡œ, ê° BC ë³„ ì£¼ìš” Aggregate ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ìƒì •í•œë‹¤.

- Messaging BC
  - `Message` (Aggregate Root)
    - `messageId`, `roomId`/`channelId`, `senderId`, `content`, `messageType`, `sentAt`, `status`
  - `MessageRead`
    - `messageId`, `readerId`, `readAt`

- ChatRoom BC
  - `ChatRoom` ë˜ëŠ” `Channel` (Aggregate Root)
    - `roomId`/`channelId`, `name`, `type`(1:1, ê·¸ë£¹, ê³µì§€ ë“±), `createdAt`, `settings`
  - `Participant`
    - `userId`, `role`(owner, member ë“±), `joinedAt`

- Schedule BC
  - `ScheduleRule` (Aggregate Root)
    - `scheduleId`, `targetRoomId`/`targetUserId`, `messageTemplate`, `scheduleType`(ë‹¨ë°œ/ì£¼ê¸°), `cronExpression` ë˜ëŠ” `executeAt`, `status`
  - `ScheduleExecutionLog`
    - `scheduleId`, `executionId`, `executedAt`, `resultStatus`, `errorMessage`

### 3.3. ê³„ì¸µ êµ¬ì¡° (Layered Architecture)

ê° ì‹¤í–‰ ëª¨ë“ˆì€ ëŒ€ëµ ë‹¤ìŒê³¼ ê°™ì€ ë ˆì´ì–´ êµ¬ì¡°ë¥¼ ë”°ë¥¸ë‹¤.

- API ë ˆì´ì–´ (Controller)
  - REST / WebSocket ì—”ë“œí¬ì¸íŠ¸ ì •ì˜
- ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤ ë ˆì´ì–´
  - ìœ ìŠ¤ì¼€ì´ìŠ¤/ì‹œë‚˜ë¦¬ì˜¤ ë‹¨ìœ„ì˜ íŠ¸ëœì­ì…˜ ê²½ê³„ë¥¼ ê°€ì§„ ì„œë¹„ìŠ¤
- ë„ë©”ì¸ ë ˆì´ì–´
  - ì—”í‹°í‹°, Value Object, ë„ë©”ì¸ ì„œë¹„ìŠ¤
- ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜ ë ˆì´ì–´
  - JPA Repository êµ¬í˜„ì²´, ë©”ì‹œì§€ ë¸Œë¡œì»¤ ì–´ëŒ‘í„°, Redis í´ë¼ì´ì–¸íŠ¸ ë“±

---

## 4. ì´ë²¤íŠ¸ ë“œë¦¬ë¸ ì•„í‚¤í…ì²˜ (EDA)

### 4.1. ì´ë²¤íŠ¸ íë¦„ ê°œìš”

- ê¸°ë³¸ ì›ì¹™
  - ìƒíƒœ ë³€ê²½(ë©”ì‹œì§€ ìƒì„±, ì˜ˆì•½ ìŠ¤ì¼€ì¤„ ìƒì„±/ë³€ê²½, ì½ìŒ ì²˜ë¦¬ ë“±)ì€ ë„ë©”ì¸ ì´ë²¤íŠ¸ë¡œ í‘œí˜„í•œë‹¤.
  - ì™¸ë¶€ ì‹œìŠ¤í…œ/ë‹¤ë¥¸ ëª¨ë“ˆì— ì•Œë¦´ í•„ìš”ê°€ ìˆëŠ” ë³€ê²½ì€ í†µí•© ì´ë²¤íŠ¸(Integration Event) ë¡œ ë³€í™˜í•˜ì—¬ ë¸Œë¡œì»¤(Redis Pub/Sub, ì¶”í›„ Kafka/RabbitMQ)ë¡œ ë°œí–‰í•œë‹¤.

- ëŒ€í‘œ ì´ë²¤íŠ¸ ì˜ˆì‹œ
  - `MessageCreatedEvent`
  - `MessageDeliveredEvent`
  - `MessageReadEvent`
  - `ScheduleCreatedEvent`
  - `ScheduleExecutedEvent`

### 4.2. ë¸Œë¡œì»¤ ë° ì±„ë„ ì„¤ê³„

- Redis Pub/Sub (í˜„ì¬ ì„¤ê³„ ê¸°ì¤€)
  - ì—­í• : `chat-message-server` ì—ì„œ ë°œí–‰í•œ ë©”ì‹œì§€ë¥¼ ë‹¤ìˆ˜ì˜ `chat-websocket-server` ì¸ìŠ¤í„´ìŠ¤ë¡œ íŒ¬ì•„ì›ƒ
  - ì±„ë„ ì„¤ê³„ ì˜ˆì‹œ
    - `chat:room:{roomId}`
    - `chat:user:{userId}`

- í–¥í›„ í™•ì¥ì„±
  - ê³ ë¶€í•˜/ëŒ€ê·œëª¨ í™˜ê²½ì´ë‚˜ ê¸°ëŠ¥ í™•ì¥(ì•Œë¦¼, ë¶„ì„ ì´ë²¤íŠ¸ ë“±)ì„ ìœ„í•´ Kafkaë‚˜ RabbitMQ ë¥¼ ë„ì…í•  ìˆ˜ ìˆë„ë¡ ì´ë²¤íŠ¸ ëª¨ë¸ì„ ë¸Œë¡œì»¤ì— ì¢…ì†ë˜ì§€ ì•Šê²Œ ì„¤ê³„í•œë‹¤.

### 4.3. Outbox íŒ¨í„´ (í–¥í›„ ì ìš© ë°©í–¥)

- ë¬¸ì œ ì¸ì‹
  - ë©”ì‹œì§€ ì €ì¥(DB íŠ¸ëœì­ì…˜)ê³¼ ë¸Œë¡œì»¤ ë°œí–‰(Redis publish)ì´ ë¶„ë¦¬ë˜ë©´, ì¤‘ê°„ ì‹¤íŒ¨ ì‹œ ë°ì´í„° ì†ì‹¤/ì¤‘ë³µ ìœ„í—˜ì´ ìˆë‹¤.
- í•´ê²° ë°©í–¥
  - `chat-message-server` + `chat-storage`ì— Outbox í…Œì´ë¸”ì„ ë„ì…í•˜ì—¬, ë©”ì‹œì§€ ì €ì¥ê³¼ Outbox ê¸°ë¡ì„ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì²˜ë¦¬í•œë‹¤.
  - ë³„ë„ Outbox ì²˜ë¦¬ê¸°(ìŠ¤ì¼€ì¤„ëŸ¬/ë°°ì¹˜)ê°€ Outbox í…Œì´ë¸”ì„ í´ë§í•˜ë©° ë¸Œë¡œì»¤ë¡œ ë°œí–‰ í›„, ì„±ê³µ ì‹œ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•œë‹¤.

---

## 5. ëª¨ë“ˆë³„ ì£¼ìš” í”Œë¡œìš°

### 5.1. ë©”ì‹œì§€ ë°œì†¡ í”Œë¡œìš° (`chat-message-server`)

1. í´ë¼ì´ì–¸íŠ¸ê°€ REST API ë¡œ ë©”ì‹œì§€ ë°œì†¡ ìš”ì²­
2. ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì¸ì¦/ì¸ê°€ ë° ìš”ì²­ DTO ê²€ì¦
3. ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤ì—ì„œ ë„ë©”ì¸ ê·œì¹™ ê²€ì¦(ì˜ˆ: ê¶Œí•œ, ë°© ìƒíƒœ, ë©”ì‹œì§€ ê¸¸ì´ ì œí•œ)
4. `chat-storage` ë¥¼ í†µí•´ ë©”ì‹œì§€ ì—”í‹°í‹° ì €ì¥
5. ì €ì¥ ì„±ê³µ í›„ ì´ë²¤íŠ¸ ìƒì„±
   - ê°„ë‹¨í•œ êµ¬ì¡°ì—ì„œëŠ” ë°”ë¡œ Redis Pub/Sub ìœ¼ë¡œ ë°œí–‰
   - Outbox íŒ¨í„´ ì ìš© ì‹œ Outbox í…Œì´ë¸”ì— ê¸°ë¡
6. `chat-websocket-server` ê°€ Redis êµ¬ë…ì„ í†µí•´ ë©”ì‹œì§€ ìˆ˜ì‹  í›„, í•´ë‹¹ ì„¸ì…˜ìœ¼ë¡œ push

### 5.2. ë©”ì‹œì§€ ì¡°íšŒ (Cursor ê¸°ë°˜ í˜ì´ì§•, `chat-system-server`)

1. í´ë¼ì´ì–¸íŠ¸ê°€ íŠ¹ì • ì±„íŒ…ë°©/ì±„ë„ì˜ ë©”ì‹œì§€ ëª©ë¡ì„ ìš”ì²­, `cursor` ì™€ `limit` ë¥¼ í•¨ê»˜ ì „ë‹¬
   - `cursor` ëŠ” ë§ˆì§€ë§‰ìœ¼ë¡œ ì¡°íšŒí•œ ë©”ì‹œì§€ì˜ `messageId` ë˜ëŠ” `sentAt` ë“±ì˜ ê¸°ì¤€ê°’
2. ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤ì—ì„œ ê¶Œí•œ ë° íŒŒë¼ë¯¸í„° ê²€ì¦
3. `chat-storage` ì¡°íšŒ ì‹œ
   - `WHERE sent_at < :cursorSentAt ORDER BY sent_at DESC LIMIT :limit` ì™€ ê°™ì€ í˜•íƒœë¡œ êµ¬í˜„
4. ê²°ê³¼ì™€ í•¨ê»˜ ë‹¤ìŒ í˜ì´ì§€ ìš”ì²­ì„ ìœ„í•œ `nextCursor` ë¥¼ ë°˜í™˜
5. í´ë¼ì´ì–¸íŠ¸ëŠ” `nextCursor` ë¥¼ ì‚¬ìš©í•´ ì¶”ê°€ ì¡°íšŒë¥¼ ìˆ˜í–‰

### 5.3. ì±„íŒ…ë°© ê´€ë¦¬ (`chat-system-server`)

- ì±„íŒ…ë°© ìƒì„±
  - ìš”ì²­ â†’ ê²€ì¦ â†’ `ChatRoom` Aggregate ìƒì„± â†’ `chat-storage` ì €ì¥ â†’ í•„ìš” ì‹œ ì´ë²¤íŠ¸ ë°œí–‰
- ì±„íŒ…ë°© ì„¤ì • ë³€ê²½/ì°¸ì—¬ì ê´€ë¦¬ë„ ìœ ì‚¬í•œ í”Œë¡œìš°ë¡œ ì²˜ë¦¬

### 5.4. ì˜ˆì•½ ë©”ì‹œì§€ ì²˜ë¦¬ (`chat-system-server` + ìŠ¤ì¼€ì¤„ëŸ¬)

- ì˜ˆì•½ ë“±ë¡
  1. í´ë¼ì´ì–¸íŠ¸ê°€ ì˜ˆì•½ ë©”ì‹œì§€ ìƒì„± ìš”ì²­ (ë‹¨ë°œ/ì£¼ê¸°, ì‹œê°„/í¬ë¡  í‘œí˜„ì‹ í¬í•¨)
  2. `ScheduleRule` Aggregate ìƒì„± ë° `chat-storage` ì— ì €ì¥
  3. (Quartz ë“± ì‚¬ìš© ì‹œ) í•´ë‹¹ Rule ì— ëŒ€í•œ Job/Trigger ë¥¼ ë“±ë¡

- ì‹¤í–‰ ì‹œë‚˜ë¦¬ì˜¤
  1. ìŠ¤ì¼€ì¤„ëŸ¬(Quartz ë“±)ê°€ ì‹œê°/í¬ë¡ ì— ë§ì¶° Job ì‹¤í–‰
  2. Job ì´ `chat-system-server` ë˜ëŠ” ë‚´ë¶€ ì„œë¹„ìŠ¤ ë¡œì§ì„ í˜¸ì¶œ
  3. í•´ë‹¹ ì‹œì ì˜ Rule ìƒíƒœ/ì¡°ê±´ì„ ì¬ê²€ì¦ (ì·¨ì†Œ/ìˆ˜ì • ì—¬ë¶€ ë“±)
  4. ìµœì¢…ì ìœ¼ë¡œ `chat-message-server` ë¥¼ í˜¸ì¶œí•˜ì—¬ ì‹¤ì œ ë©”ì‹œì§€ ë°œì†¡
  5. `ScheduleExecutionLog` ì— ì‹¤í–‰ ê²°ê³¼ ê¸°ë¡

- ë™ì‹œ ì‹¤í–‰/ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€ ì „ëµ (ê°œëµ)
  - ë‹¨ë°œì„± ìŠ¤ì¼€ì¤„
    - `ScheduleRule` ë˜ëŠ” í•´ë‹¹ ì˜ˆì•½ ë©”ì‹œì§€ì— ëŒ€í•´ ìƒíƒœ í”Œë˜ê·¸ë¥¼ ë‘ê³ , ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹œ ë‚™ê´€ì  ë½/ë²„ì „ í•„ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€
  - ì£¼ê¸° ìŠ¤ì¼€ì¤„
    - ë©”ì‹œì§€ ë‹¨ìœ„ê°€ ì•„ë‹ˆë¼ `scheduleId + nextExecutionTime` ë‹¨ìœ„ë¡œ ì‹ë³„ì/ì œì•½ì¡°ê±´ì„ ë‘¬ì„œ, ë™ì‹œì— ê°™ì€ Slot ì´ ë‘ ë²ˆ ì‹¤í–‰ë˜ì§€ ì•Šë„ë¡ ì„¤ê³„
    - ë˜ëŠ” ë‹¨ë°œ Job ê³¼ ì£¼ê¸° Job ì„ ì™„ì „íˆ ë¶„ë¦¬í•˜ì—¬, ì£¼ê¸° Job ì€ ë©”ì‹œì§€ ë‹¨ìœ„ê°€ ì•„ë‹Œ â€œì£¼ê¸° ìŠ¬ë¡¯â€ ë‹¨ìœ„ë¡œë§Œ ë³´ì¥

---

## 6. ê³µí†µ ëª¨ë“ˆ (`common`) ì„¤ê³„

### 6.1. ë¡œê¹…

- ê³µí†µ ë¡œê·¸ í¬ë§· (JSON/êµ¬ì¡°í™” ë¡œê·¸)
- TraceId/SpanId, ì‚¬ìš©ì ID, ìš”ì²­ ID ë¥¼ MDC ì— ë‹´ëŠ” ìœ í‹¸ë¦¬í‹° ì œê³µ

### 6.2. ì˜ˆì™¸ ë° ì—ëŸ¬ ì‘ë‹µ

- `BusinessException` + `ErrorCode` ê¸°ë°˜ ê³µí†µ ì˜ˆì™¸ ì²˜ë¦¬
- API ì‘ë‹µ í¬ë§· í†µì¼ (ì„±ê³µ/ì‹¤íŒ¨ ëª¨ë‘ ì¼ì •í•œ êµ¬ì¡°)

### 6.3. ìœ í‹¸ë¦¬í‹° ë° ìƒìˆ˜

- ë‚ ì§œ/ì‹œê°„
- ID/í† í° ê´€ë ¨
- Validation Helper ë“±

---

## 7. ì €ì¥ì†Œ ë° ë°ì´í„° ëª¨ë¸ (`chat-storage`)

### 7.1. ì£¼ìš” í…Œì´ë¸”(ê°œëµ)

- `chat_room` / `channel`
  - ë°©/ì±„ë„ ë©”íƒ€ë°ì´í„°, íƒ€ì…, ìƒì„±ì¼, ì„¤ì •ê°’ ë“±
- `message`
  - ë©”ì‹œì§€ ë³¸ë¬¸/ë©”íƒ€ë°ì´í„°, ë°œì‹ ì, ë°œì†¡ ì‹œê°, ìƒíƒœ
- `message_read`
  - ë©”ì‹œì§€ë³„ ì½ìŒ ì •ë³´ (ì‚¬ìš©ì/ì‹œê°„)
- `schedule_rule`
  - ì˜ˆì•½ ë©”ì‹œì§€ ê·œì¹™ (ë‹¨ë°œ/ì£¼ê¸°, ì‹œê°„/í¬ë¡ , ëŒ€ìƒ, ìƒíƒœ ë“±)
- `schedule_execution_log`
  - ìŠ¤ì¼€ì¤„ ì‹¤í–‰ ì´ë ¥ (ì„±ê³µ/ì‹¤íŒ¨, ì—ëŸ¬ ë©”ì‹œì§€ ë“±)

### 7.2. Read/Write ë¶„ë¦¬(CQRS)

- ì“°ê¸°
  - `source DB` ì—ì„œ ë©”ì‹œì§€/ë°©/ìŠ¤ì¼€ì¤„ì„ ì €ì¥ ë° ê°±ì‹ 
- ì½ê¸°
  - `replica DB` ë¥¼ ì´ìš©í•´ ì¡°íšŒ ì„±ëŠ¥ì„ ìµœì í™”
- í›„ì† ë‹¨ê³„ì—ì„œ ë©”ì‹œì§€/ë°© ë‹¨ìœ„ ìƒ¤ë”©ë„ ê³ ë ¤ ê°€ëŠ¥

---

## 8. SaaS / ë©€í‹°í…Œë„ŒíŠ¸ ê³ ë ¤

### 8.1. Tenant ê°œë… ë„ì… ìœ„ì¹˜

- ì˜µì…˜ 1: Row-level TenantId
  - ëª¨ë“  ì£¼ìš” í…Œì´ë¸”(`chat_room`, `message`, `schedule_rule` ë“±)ì— `tenant_id` ì»¬ëŸ¼ ì¶”ê°€
- ì˜µì…˜ 2: ìŠ¤í‚¤ë§ˆ/DB ë¶„ë¦¬
  - í…Œë„ŒíŠ¸ë³„ë¡œ ë³„ë„ ìŠ¤í‚¤ë§ˆ ë˜ëŠ” DB ì¸ìŠ¤í„´ìŠ¤ë¥¼ í• ë‹¹

### 8.2. í˜„ì¬ ë‹¨ê³„ ê¸°ë³¸ ë°©ì¹¨

- ì´ˆê¸° êµ¬í˜„ì€ ë‹¨ì¼ í…Œë„ŒíŠ¸ êµ¬ì¡°ë¡œ êµ¬í˜„í•˜ë˜, ë„ë©”ì¸ ëª¨ë¸ê³¼ API ì—ì„œ Tenant í™•ì¥ì„ ê³ ë ¤í•œ ì„¤ê³„ë¥¼ ìœ ì§€í•œë‹¤.
- ì„œë¡œ ë‹¤ë¥¸ í…Œë„ŒíŠ¸ ê°„ì— ì±„íŒ…ë°©/ë©”ì‹œì§€ë¥¼ ê³µìœ í•˜ì§€ ì•ŠëŠ” ê²ƒì„ ê¸°ë³¸ ì •ì±…ìœ¼ë¡œ í•œë‹¤.

---

## 9. ë¹„ê¸°ëŠ¥ ìš”êµ¬ ë° ìš´ì˜

- í™•ì¥ì„±
  - `chat-message-server`, `chat-system-server`, `chat-websocket-server` ë¥¼ ê°ê° ë…ë¦½ì ìœ¼ë¡œ ìŠ¤ì¼€ì¼ ì•„ì›ƒ ê°€ëŠ¥í•˜ê²Œ ì„¤ê³„
- ì¥ì•  ê²©ë¦¬
  - ë©”ì‹œì§€ ë°œì†¡ ì¥ì• ì™€ ì±„íŒ…ë°© ê´€ë¦¬ ì¥ì• ë¥¼ ë¶„ë¦¬í•˜ì—¬, í•œ ì˜ì—­ì˜ ì¥ì• ê°€ ì „ì²´ ì„œë¹„ìŠ¤ì— ì˜í–¥ì„ ìµœì†Œí™”í•˜ë„ë¡ í•œë‹¤.
- ëª¨ë‹ˆí„°ë§/ë¡œê¹…
  - ê³µí†µ ë¡œê¹… í¬ë§· + APM/ë¡œê·¸ ìˆ˜ì§‘ ì‹œìŠ¤í…œ(ì˜ˆ: ELK, Grafana Loki ë“±) ì—°ê³„
- ë³´ì•ˆ
  - `security` ëª¨ë“ˆ/ì˜ì¡´ì„±ì„ í†µí•œ JWT ê¸°ë°˜ ì¸ì¦/ì¸ê°€, ê¶Œí•œ ì²´í¬ ì •ì±… ìˆ˜ë¦½

---

## 10. í–¥í›„ í™•ì¥ ë° ë¡œë“œë§µ

- Outbox íŒ¨í„´ ì •ì‹ ë„ì… ë° ì´ë²¤íŠ¸ ë°œí–‰ ì¸í”„ë¼ ê³ ë„í™”
- ë©”ì‹œì§€ íƒ€ì… í™•ì¥ (íŒŒì¼, ì´ë¯¸ì§€, ì‹œìŠ¤í…œ ì•Œë¦¼, ë´‡ ë©”ì‹œì§€ ë“±)
- ê³ ê¸‰ ì¡°íšŒ ê¸°ëŠ¥ (ê²€ìƒ‰, í•„í„°ë§, í•˜ì´ë¼ì´íŒ…)
- SaaS ë©€í‹°í…Œë„Œì‹œ ì •ì‹ ì§€ì› (Tenant ê´€ë¦¬, Billing ì—°ë™ ë“±)
- ëŒ€ê·œëª¨ íŠ¸ë˜í”½ ëŒ€ì‘ì„ ìœ„í•œ ë©”ì‹œì§• ë¸Œë¡œì»¤(Kafka/RabbitMQ) ë„ì… ë° ë¦¬íŒ©í† ë§

---

## 11. í”„ë¡œì íŠ¸ ì¬ê±´ ì‹¤í–‰ ê³„íš (STEP)

> ì´ ì„¹ì…˜ì€ ê¸°ì¡´ í”„ë¡œì íŠ¸ë¥¼ ìœ„ ì•„í‚¤í…ì²˜ ì„¤ê³„ì— ë§ì¶° ì‹¤ì œë¡œ ì¬êµ¬ì„±í•˜ê¸° ìœ„í•œ êµ¬ì²´ì ì¸ ë‹¨ê³„ë³„ ì‹¤í–‰ ê³„íšì…ë‹ˆë‹¤.

### 11.1. í˜„ì¬ ìƒíƒœ ë¶„ì„

**í˜„ì¬ ëª¨ë“ˆ êµ¬ì¡°**
- `chat-common`: ê³µí†µ ìœ í‹¸, ì˜ˆì™¸, DTO, Port ì¸í„°í˜ì´ìŠ¤ ë“± í˜¼ì¬
- `chat-storage`: Entity, Repository, Adapter ë“± ì˜ì†ì„± ê³„ì¸µ
- `chat-message-server`: ë©”ì‹œì§€ ë°œì†¡ API ì„œë²„
- `chat-system-server`: ì‹œìŠ¤í…œ ê´€ë¦¬ API ì„œë²„
- `chat-websocket-server`: WebSocket ì„œë²„
- `domain`: (ì—­í•  ë¶ˆëª…í™•, ì¡°ì‚¬ í•„ìš”)

**ë¬¸ì œì  ë° ê°œì„  ëª©í‘œ**
1. `chat-common`ì— ë„ë©”ì¸ íŠ¹í™” í´ë˜ìŠ¤(`ChatMessage`, `UserId`, Port ì¸í„°í˜ì´ìŠ¤ ë“±)ê°€ í¬í•¨ë˜ì–´ ìˆìŒ
2. ìˆœìˆ˜ ê³µí†µ ìœ í‹¸ë¦¬í‹°ì™€ ë„ë©”ì¸ ë¡œì§ì´ ë¶„ë¦¬ë˜ì§€ ì•ŠìŒ
3. ë‹¤ì–‘í•œ ë©”ì‹œì§€ íƒ€ì… í™•ì¥ì„ ìœ„í•œ ì „ëµ íŒ¨í„´/íŒ©í† ë¦¬ êµ¬ì¡°ê°€ ëª…í™•í•˜ì§€ ì•ŠìŒ
4. ëª¨ë“ˆ ê°„ ì˜ì¡´ì„± ê²½ê³„ê°€ ë¶ˆëª…í™•í•¨

### 11.2. STEP 1: `common` ëª¨ë“ˆ ì„¸ë¶„í™” ë° ì¬êµ¬ì„±

**ëª©í‘œ**: `chat-common`ì„ 3ê°œì˜ ë…ë¦½ì ì¸ ì„œë¸Œ ëª¨ë“ˆ(`common-util`, `common-auth`, `common-logging`)ë¡œ ë¶„ë¦¬í•˜ì—¬ ëª…í™•í•œ ì±…ì„ ê²½ê³„ í™•ë¦½

**ë°°ê²½**
- ê¸°ì¡´ `chat-common`ì€ ë‹¤ì–‘í•œ ì±…ì„ì´ í˜¼ì¬ë˜ì–´ ì˜ì¡´ì„± ê´€ë¦¬ê°€ ì–´ë ¤ì›€
- ë¡œê¹…, ì¸ì¦, ìœ í‹¸ë¦¬í‹°ë¥¼ ë¶„ë¦¬í•˜ì—¬ í•„ìš”í•œ ëª¨ë“ˆë§Œ ì„ íƒì ìœ¼ë¡œ ì˜ì¡´ ê°€ëŠ¥í•˜ê²Œ í•¨
- í–¥í›„ í™•ì¥ì„±(ELK Stack, ì™¸ë¶€ ì¸ì¦ ì‹œìŠ¤í…œ ì—°ë™ ë“±)ì„ ê³ ë ¤í•œ êµ¬ì¡°

**ì„¸ë¶€ ì‘ì—…**

#### A. ëª¨ë“ˆ êµ¬ì¡° ìƒì„±

1. **`settings.gradle` ìˆ˜ì •**
   ```groovy
   rootProject.name = 'chat-platform'
   
   // common ì„œë¸Œ ëª¨ë“ˆ 3ê°œ ì¶”ê°€
   include 'common-util'
   include 'common-auth'
   include 'common-logging'
   
   include 'chat-storage'
   include 'chat-message-server'
   include 'chat-system-server'
   include 'chat-websocket-server'
   ```

2. **ë””ë ‰í† ë¦¬ êµ¬ì¡° ìƒì„±**
   ```
   chat-platform/
   â”œâ”€â”€ common-util/
   â”‚   â”œâ”€â”€ build.gradle
   â”‚   â””â”€â”€ src/main/java/com/example/chat/common/util/
   â”œâ”€â”€ common-auth/
   â”‚   â”œâ”€â”€ build.gradle
   â”‚   â””â”€â”€ src/main/java/com/example/chat/common/auth/
   â”œâ”€â”€ common-logging/
   â”‚   â”œâ”€â”€ build.gradle
   â”‚   â””â”€â”€ src/main/java/com/example/chat/common/logging/
   â””â”€â”€ ...
   ```

#### B. `common-util` ëª¨ë“ˆ êµ¬ì„±

**ì±…ì„**: ì˜ˆì™¸, ìƒìˆ˜, ë²”ìš© ìœ í‹¸ë¦¬í‹°

**build.gradle**:
```groovy
plugins {
    id 'java-library'
}

java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(21)
    }
}

bootJar.enabled = false
jar.enabled = true

dependencies {
    // ìµœì†Œ ì˜ì¡´ì„±
    compileOnly 'org.projectlombok:lombok'
    annotationProcessor 'org.projectlombok:lombok'
    
    // Spring Framework (ì˜ˆì™¸ ì²˜ë¦¬ìš©)
    implementation 'org.springframework:spring-web'
    implementation 'org.springframework:spring-context'
    
    // Jackson (JSON ì²˜ë¦¬)
    implementation 'com.fasterxml.jackson.core:jackson-databind'
}
```

**ì´ê´€í•  íŒŒì¼**:
- `exception/`
  - âœ… `BaseException.java`
  - âœ… `BaseErrorCode.java`
  - âœ… `ErrorCode.java`
  - âœ… `GlobalExceptionHandler.java` (Spring MVC)
- `constants/`
  - âœ… `MessageConstant.java`
  - âœ… HTTP í—¤ë”, ì‹œìŠ¤í…œ ìƒìˆ˜ ë“±
- `util/`
  - âœ… `CursorCodec.java`
  - âœ… `Cursor.java`
  - âœ… `ThrowReader.java`
  - âœ… `DateTimeUtil.java` (ì‹ ê·œ ì‘ì„±)
  - âœ… `IdGenerator.java` (ì‹ ê·œ ì‘ì„±)
  - âœ… `ValidationHelper.java` (ì‹ ê·œ ì‘ì„±)

**ì œê±°í•  í•­ëª©** (ë‹¤ë¥¸ ëª¨ë“ˆë¡œ ì´ë™):
- âŒ `dto/ChatMessage` â†’ `chat-storage/domain/message/`ë¡œ ì´ë™
- âŒ `dto/UserId` â†’ `common-auth`ë¡œ ì´ë™ (ì‚¬ìš©ì ì‹ë³„ìì´ë¯€ë¡œ)
- âŒ `port/MessageService`, `port/MessageReadRepository` â†’ `chat-storage` ë˜ëŠ” ê° ì„œë²„ ëª¨ë“ˆë¡œ ì´ë™
- âŒ `logging/MdcUtil`, `logging/RequestLoggingFilter` â†’ `common-logging`ìœ¼ë¡œ ì´ë™

**íŒ¨í‚¤ì§€ êµ¬ì¡°**:
```
common-util/
â””â”€â”€ src/main/java/com/example/chat/common/util/
    â”œâ”€â”€ exception/
    â”‚   â”œâ”€â”€ BaseException.java
    â”‚   â”œâ”€â”€ BaseErrorCode.java
    â”‚   â”œâ”€â”€ ErrorCode.java
    â”‚   â””â”€â”€ GlobalExceptionHandler.java
    â”œâ”€â”€ constants/
    â”‚   â”œâ”€â”€ MessageConstant.java
    â”‚   â”œâ”€â”€ HeaderConstants.java
    â”‚   â””â”€â”€ SystemConstants.java
    â””â”€â”€ util/
        â”œâ”€â”€ CursorCodec.java
        â”œâ”€â”€ Cursor.java
        â”œâ”€â”€ ThrowReader.java
        â”œâ”€â”€ DateTimeUtil.java
        â”œâ”€â”€ IdGenerator.java
        â””â”€â”€ ValidationHelper.java
```

#### C. `common-auth` ëª¨ë“ˆ êµ¬ì„±

**ì±…ì„**: ì¸ì¦/ì¸ê°€, JWT, ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸

**build.gradle**:
```groovy
plugins {
    id 'java-library'
}

bootJar.enabled = false
jar.enabled = true

dependencies {
    // common-util ì˜ì¡´
    api project(':common-util')
    
    compileOnly 'org.projectlombok:lombok'
    annotationProcessor 'org.projectlombok:lombok'
    
    // Spring Security
    implementation 'org.springframework.boot:spring-boot-starter-security'
    
    // JWT
    implementation 'io.jsonwebtoken:jjwt-api:0.12.3'
    runtimeOnly 'io.jsonwebtoken:jjwt-impl:0.12.3'
    runtimeOnly 'io.jsonwebtoken:jjwt-jackson:0.12.3'
}
```

**êµ¬í˜„í•  í´ë˜ìŠ¤**:
- `jwt/`
  - `JwtTokenProvider.java`: JWT ìƒì„±/ê²€ì¦
  - `JwtProperties.java`: JWT ì„¤ì • (secret, expiration ë“±)
- `model/`
  - `UserId.java`: ì‚¬ìš©ì ì‹ë³„ì VO (`chat-common`ì—ì„œ ì´ë™)
  - `AuthUser.java`: ì¸ì¦ëœ ì‚¬ìš©ì ì •ë³´
  - `UserPrincipal.java`: Spring Security Principal êµ¬í˜„
- `filter/`
  - `JwtAuthenticationFilter.java`: JWT í•„í„°
- `context/`
  - `UserContextHolder.java`: ThreadLocal ê¸°ë°˜ ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸
- `annotation/`
  - `@RequireAuth`: ì¸ì¦ í•„ìš” í‘œì‹œ
  - `@RequireRole`: íŠ¹ì • ê¶Œí•œ í•„ìš” í‘œì‹œ
- `aspect/`
  - `AuthAspect.java`: ê¶Œí•œ ì²´í¬ AOP

**íŒ¨í‚¤ì§€ êµ¬ì¡°**:
```
common-auth/
â””â”€â”€ src/main/java/com/example/chat/common/auth/
    â”œâ”€â”€ jwt/
    â”‚   â”œâ”€â”€ JwtTokenProvider.java
    â”‚   â””â”€â”€ JwtProperties.java
    â”œâ”€â”€ model/
    â”‚   â”œâ”€â”€ UserId.java
    â”‚   â”œâ”€â”€ AuthUser.java
    â”‚   â””â”€â”€ UserPrincipal.java
    â”œâ”€â”€ filter/
    â”‚   â””â”€â”€ JwtAuthenticationFilter.java
    â”œâ”€â”€ context/
    â”‚   â””â”€â”€ UserContextHolder.java
    â”œâ”€â”€ annotation/
    â”‚   â”œâ”€â”€ RequireAuth.java
    â”‚   â””â”€â”€ RequireRole.java
    â””â”€â”€ aspect/
        â””â”€â”€ AuthAspect.java
```

#### D. `common-logging` ëª¨ë“ˆ êµ¬ì„±

**ì±…ì„**: ë¡œê¹…, ë¶„ì‚° ì¶”ì , í–¥í›„ ELK Stack ì—°ë™ ëŒ€ë¹„

**build.gradle**:
```groovy
plugins {
    id 'java-library'
}

bootJar.enabled = false
jar.enabled = true

dependencies {
    // common-util ì˜ì¡´
    api project(':common-util')
    
    compileOnly 'org.projectlombok:lombok'
    annotationProcessor 'org.projectlombok:lombok'
    
    // SLF4J, Logback
    implementation 'org.slf4j:slf4j-api'
    implementation 'ch.qos.logback:logback-classic'
    
    // Spring Web (Filter ìš©)
    implementation 'org.springframework:spring-web'
    
    // (í–¥í›„) Logstash Encoder
    // implementation 'net.logstash.logback:logstash-logback-encoder:7.4'
    
    // (í–¥í›„) OpenTelemetry
    // implementation 'io.opentelemetry:opentelemetry-api'
}
```

**ì´ê´€í•  íŒŒì¼**:
- `MdcUtil.java` (`chat-common`ì—ì„œ ì´ë™)
- `RequestLoggingFilter.java` (`chat-common`ì—ì„œ ì´ë™)

**ì‹ ê·œ êµ¬í˜„í•  í´ë˜ìŠ¤**:
- `trace/`
  - `TraceIdGenerator.java`: TraceId, SpanId ìƒì„±
  - `TraceContext.java`: ì¶”ì  ì»¨í…ìŠ¤íŠ¸
- `filter/`
  - `RequestLoggingFilter.java`: HTTP ìš”ì²­ ë¡œê¹…
  - `MdcFilter.java`: MDC ì„¤ì • í•„í„°
- `config/`
  - `LoggingConfig.java`: ë¡œê¹… ì„¤ì •

**íŒ¨í‚¤ì§€ êµ¬ì¡°**:
```
common-logging/
â””â”€â”€ src/main/java/com/example/chat/common/logging/
    â”œâ”€â”€ MdcUtil.java
    â”œâ”€â”€ trace/
    â”‚   â”œâ”€â”€ TraceIdGenerator.java
    â”‚   â””â”€â”€ TraceContext.java
    â”œâ”€â”€ filter/
    â”‚   â”œâ”€â”€ RequestLoggingFilter.java
    â”‚   â””â”€â”€ MdcFilter.java
    â””â”€â”€ config/
        â””â”€â”€ LoggingConfig.java
```

**âš ï¸ ì¤‘ìš”**: `common-logging`ì€ ì´ˆê¸° êµ¬í˜„ ë‹¨ê³„ì—ì„œëŠ” ê¸°ë³¸ ê¸°ëŠ¥ë§Œ êµ¬í˜„í•˜ê³ , **í–¥í›„ ELK Stack, Grafana Loki, OpenTelemetry ë“±ìœ¼ë¡œ ì „í™˜í•  ë•Œ ë³¸ê²©ì ìœ¼ë¡œ í™•ì¥**í•  ì˜ˆì •ì…ë‹ˆë‹¤.

#### E. ì˜ì¡´ì„± ì •ë¦¬ ë° ê²€ì¦

1. **ê° ì‹¤í–‰ ëª¨ë“ˆì˜ `build.gradle` ìˆ˜ì •**
   ```groovy
   // chat-message-server/build.gradle
   dependencies {
       implementation project(':common-util')
       implementation project(':common-auth')
       implementation project(':common-logging')
       implementation project(':chat-storage')
       // ...
   }
   
   // chat-system-server/build.gradle
   dependencies {
       implementation project(':common-util')
       implementation project(':common-auth')
       implementation project(':common-logging')
       implementation project(':chat-storage')
       // ...
   }
   
   // chat-websocket-server/build.gradle
   dependencies {
       implementation project(':common-util')
       implementation project(':common-auth')
       implementation project(':common-logging')
       // chat-storageëŠ” ì„ íƒì 
       // ...
   }
   ```

2. **ì˜ì¡´ì„± ë°©í–¥ ê²€ì¦**
   ```
   common-util (ìµœí•˜ìœ„, ì˜ì¡´ì„± ì—†ìŒ)
       â†‘
       â”œâ”€â”€ common-auth â†’ common-util
       â””â”€â”€ common-logging â†’ common-util
   
   ì‹¤í–‰ ëª¨ë“ˆë“¤ (chat-*-server) â†’ í•„ìš”í•œ common ì„œë¸Œ ëª¨ë“ˆ ì„ íƒì  ì˜ì¡´
   ```

3. **ìˆœí™˜ ì˜ì¡´ ì²´í¬**
   - `common-util`, `common-auth`, `common-logging`ì€ ì„œë¡œ ì˜ì¡´í•˜ì§€ ì•ŠìŒ (ë‹¨, `common-auth`ì™€ `common-logging`ì€ `common-util`ì—ë§Œ ì˜ì¡´)
   - `common-*` ëª¨ë“ˆë“¤ì€ `chat-storage`ë‚˜ ì‹¤í–‰ ëª¨ë“ˆì— ì˜ì¡´í•˜ì§€ ì•ŠìŒ

#### F. ë§ˆì´ê·¸ë ˆì´ì…˜ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] `settings.gradle`ì— 3ê°œ ì„œë¸Œ ëª¨ë“ˆ ì¶”ê°€
- [ ] ê° ì„œë¸Œ ëª¨ë“ˆ ë””ë ‰í† ë¦¬ ë° `build.gradle` ìƒì„±
- [ ] `chat-common`ì˜ íŒŒì¼ë“¤ì„ ì ì ˆí•œ ì„œë¸Œ ëª¨ë“ˆë¡œ ì´ë™
  - [ ] ì˜ˆì™¸/ìƒìˆ˜/ìœ í‹¸ â†’ `common-util`
  - [ ] `UserId`, JWT ê´€ë ¨ â†’ `common-auth`
  - [ ] ë¡œê¹… ê´€ë ¨ â†’ `common-logging`
- [ ] `ChatMessage`, Port ì¸í„°í˜ì´ìŠ¤ ë“±ì€ `chat-storage` ë˜ëŠ” í•´ë‹¹ ì„œë²„ ëª¨ë“ˆë¡œ ì´ë™
- [ ] ëª¨ë“  ì‹¤í–‰ ëª¨ë“ˆì˜ import ê²½ë¡œ ìˆ˜ì •
  - `com.example.chat.common.*` â†’ `com.example.chat.common.util.*`, `com.example.chat.common.auth.*` ë“±
- [ ] ë¹Œë“œ ì„±ê³µ í™•ì¸: `./gradlew build`
- [ ] í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë° ê²€ì¦

**ì˜ˆìƒ ì†Œìš” ì‹œê°„**: 1-2ì¼

**ê²°ê³¼ë¬¼**:
- ëª…í™•í•˜ê²Œ ë¶„ë¦¬ëœ 3ê°œì˜ `common` ì„œë¸Œ ëª¨ë“ˆ
- í•„ìš”í•œ ëª¨ë“ˆë§Œ ì„ íƒì ìœ¼ë¡œ ì˜ì¡´í•  ìˆ˜ ìˆëŠ” ìœ ì—°í•œ êµ¬ì¡°
- í–¥í›„ í™•ì¥ì„±(ELK, OAuth ë“±) ëŒ€ë¹„

---

## 12. STEP ì‹¤í–‰ ìˆœì„œ ìš”ì•½

| ë‹¨ê³„ | ë‚´ìš© | ìš°ì„ ìˆœìœ„ | ìƒíƒœ | ì‹¤ì œ ì†Œìš” |
|-----|------|---------|------|----------|
| STEP 1 | `common` ëª¨ë“ˆ ì„¸ë¶„í™” (common-util, common-auth, common-logging) | ë†’ìŒ | âœ… ì™„ë£Œ | 2ì¼ |
| STEP 2 | `chat-storage` í™•ì¥ ë° ë©”ì‹œì§€ íƒ€ì… ì „ëµ ì„¤ê³„ | **ìµœìš°ì„ ** | âœ… ì™„ë£Œ | 3ì¼ |
| STEP 3 | `chat-message-server` ì¬êµ¬ì„± | ë†’ìŒ | âœ… ì™„ë£Œ | 4ì¼ |
| STEP 4 | `chat-system-server` ì¬êµ¬ì„± | ë†’ìŒ | ğŸ”„ ì§„í–‰ ì¤‘ | - |
| STEP 5 | `chat-websocket-server` ì¬êµ¬ì„± | ì¤‘ê°„ | âœ… ì™„ë£Œ | 3ì¼ |
| STEP 6 | `domain` ëª¨ë“ˆ í‰ê°€ ë° í†µí•© | ì¤‘ê°„ | âœ… ì™„ë£Œ | 1ì¼ |
| STEP 7 | ë¹Œë“œ ì„¤ì • ì •ë¦¬ | ë†’ìŒ | âœ… ì™„ë£Œ | 1ì¼ |
| STEP 8 | ì˜ˆì•½ ë©”ì‹œì§€ ì‹œìŠ¤í…œ (Quartz) | ë†’ìŒ | ğŸš€ ì‹œì‘ | - |
| STEP 9 | í™•ì¥ì„± ê²€ì¦ í…ŒìŠ¤íŠ¸ | ì¤‘ê°„ | â³ ëŒ€ê¸° | - |
| STEP 10 | ë¬¸ì„œí™” | ë‚®ìŒ | ğŸ”„ ì§„í–‰ ì¤‘ | - |

**ì´ ì˜ˆìƒ ì†Œìš”**: ì•½ 3-4ì£¼ â†’ **ì‹¤ì œ ì§„í–‰**: 2ì£¼ (67% ì™„ë£Œ)

**ì™„ë£Œëœ ê°œì„  ì‚¬í•­**:
- âœ… `common` ëª¨ë“ˆì„ 3ê°œ ì„œë¸Œ ëª¨ë“ˆë¡œ ì„¸ë¶„í™”í•˜ì—¬ ëª…í™•í•œ ì±…ì„ ë¶„ë¦¬
- âœ… `common-util`: ì˜ˆì™¸, ìƒìˆ˜, ë²”ìš© ìœ í‹¸ë¦¬í‹°
- âœ… `common-auth`: JWT, ì¸ì¦/ì¸ê°€, ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸
- âœ… `common-logging`: ë¡œê¹…, ë¶„ì‚° ì¶”ì  (í–¥í›„ ELK Stack ì—°ë™ ëŒ€ë¹„)
- âœ… ë‹¤ì–‘í•œ ë©”ì‹œì§€ íƒ€ì… í™•ì¥ì„ ìœ„í•œ ì „ëµ/íŒ©í† ë¦¬ íŒ¨í„´ ì ìš©
- âœ… Cursor ê¸°ë°˜ ë©”ì‹œì§€ ì¡°íšŒ
- âœ… ë©€í‹° ì¸ìŠ¤í„´ìŠ¤ Redis ì„¸ì…˜ ê´€ë¦¬
- âœ… SOLID ì›ì¹™ 100% ì ìš©
- âœ… ì „ë¬¸ê°€ ë¦¬íŒ©í† ë§ ì™„ë£Œ

**ì§„í–‰ ì¤‘**:
- ğŸš€ STEP 8: ì˜ˆì•½ ë©”ì‹œì§€ ì‹œìŠ¤í…œ (Quartz Scheduler)
- ğŸ”„ STEP 4: chat-system-server ê³ ë„í™”
- âœ… ì˜ˆì•½ ë©”ì‹œì§€ ìŠ¤ì¼€ì¤„ë§ (ë‹¨ë°œ/ì£¼ê¸°, ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€)

---

## 13. í•µì‹¬ ì„¤ê³„ ì›ì¹™

1. **ê°œë°©-íì‡„ ì›ì¹™ (OCP)**: ìƒˆ ë©”ì‹œì§€ íƒ€ì… ì¶”ê°€ ì‹œ ê¸°ì¡´ ì½”ë“œ ìˆ˜ì • ë¶ˆí•„ìš”
2. **ì „ëµ íŒ¨í„´**: MessageHandlerë¡œ íƒ€ì…ë³„ ë¡œì§ ë¶„ë¦¬
3. **íŒ©í† ë¦¬ íŒ¨í„´**: MessageFactoryë¡œ ìƒì„± ë¡œì§ ìº¡ìŠí™”
4. **ì˜ì¡´ì„± ì—­ì „**: ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜ í™•ì¥
5. **ë‹¨ì¼ ì±…ì„**: ê° ëª¨ë“ˆ/í´ë˜ìŠ¤ëŠ” í•˜ë‚˜ì˜ ëª…í™•í•œ ì±…ì„
