# ì„œë²„ ì‹¤í–‰ ë¬¸ì œ í•´ê²° ì™„ë£Œ ë³´ê³ ì„œ

## ğŸ“… ì‘ì—… ì¼ì: 2025-12-13

---

## ğŸ¯ ë¬¸ì œ ìƒí™©

### 1. chat-websocket-server ì‹¤í–‰ ì˜¤ë¥˜
```
Failed to configure a DataSource: 'url' attribute is not specified 
and no embedded datasource could be configured.
```

**ì›ì¸:**
- chat-storage ì˜ì¡´ì„±ìœ¼ë¡œ ì¸í•´ JPAê°€ ìë™ìœ¼ë¡œ í™œì„±í™”ë¨
- DataSource ì„¤ì •ì´ ì—†ì–´ì„œ ì‹¤í–‰ ì‹¤íŒ¨

### 2. chat-system-server ì‹¤í–‰ ì˜¤ë¥˜
```
ConflictingBeanDefinitionException: 
Annotation-specified bean name 'quartzConfig' conflicts with existing bean
```

**ì›ì¸:**
- `com.example.chat.system.config.QuartzConfig` (ì¤‘ë³µ)
- `com.example.chat.system.infrastructure.config.QuartzConfig` (ì¤‘ë³µ)

---

## âœ… í•´ê²° ë°©ë²•

### 1. chat-websocket-server ìˆ˜ì •

#### ë°©ë²• 1: JPA Auto Configuration ë¹„í™œì„±í™” âœ…
**íŒŒì¼:** `chat-websocket-server/src/main/resources/application.properties`

```properties
# JPA Auto Configuration ë¹„í™œì„±í™” (WebSocket ì„œë²„ëŠ” JPA ë¶ˆí•„ìš”)
spring.autoconfigure.exclude=\
  org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration,\
  org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration,\
  org.springframework.boot.autoconfigure.flyway.FlywayAutoConfiguration

# Redis (Session ê´€ë¦¬ìš©)
spring.data.redis.host=localhost
spring.data.redis.port=16379
spring.data.redis.password=dev_password
```

#### ë°©ë²• 2: chat-storage ì˜ì¡´ì„± ì œê±° âœ…
**íŒŒì¼:** `chat-websocket-server/build.gradle`

```groovy
dependencies {
    implementation project(':common-util')
    implementation project(':common-auth')
    implementation project(':common-logging')
    implementation project(':chat-domain')
    
    // Storage ëª¨ë“ˆ ì œê±° (WebSocket ì„œë²„ëŠ” ì˜ì†ì„± ë¶ˆí•„ìš”)
    // implementation project(':chat-storage')
}
```

**ì´ìœ :**
- chat-websocket-serverëŠ” Domain ëª¨ë¸ë§Œ ì‚¬ìš©
- ì‹¤ì œ ë°ì´í„° ì €ì¥/ì¡°íšŒëŠ” í•˜ì§€ ì•ŠìŒ
- Redis Session ê´€ë¦¬ë§Œ ìˆ˜í–‰

---

### 2. chat-system-server ì¤‘ë³µ íŒŒì¼ ì œê±°

#### ì‚­ì œí•œ íŒŒì¼ âœ…
```
âŒ chat-system-server/src/main/java/com/example/chat/system/config/QuartzConfig.java
```

#### ìœ ì§€í•œ íŒŒì¼ âœ…
```
âœ… chat-system-server/src/main/java/com/example/chat/system/infrastructure/config/QuartzConfig.java
```

**ì´ìœ :**
- infrastructure íŒ¨í‚¤ì§€ê°€ ë” ì í•©í•œ ìœ„ì¹˜
- ì¸í”„ë¼ ì„¤ì •ì€ infrastructureì— ì§‘ì¤‘

---

## ğŸ“Š ìµœì¢… í”„ë¡œì íŠ¸ êµ¬ì¡°

### chat-websocket-server
```
chat-websocket-server/
â”œâ”€â”€ build.gradle
â”‚   â””â”€â”€ dependencies:
â”‚       â”œâ”€â”€ common-util âœ…
â”‚       â”œâ”€â”€ common-auth âœ…
â”‚       â”œâ”€â”€ common-logging âœ…
â”‚       â”œâ”€â”€ chat-domain âœ…
â”‚       â””â”€â”€ chat-storage âŒ (ì œê±°)
â””â”€â”€ src/main/resources/
    â””â”€â”€ application.properties
        â””â”€â”€ JPA Auto Configuration ë¹„í™œì„±í™” âœ…
```

### chat-system-server
```
chat-system-server/
â””â”€â”€ src/main/java/com/example/chat/system/
    â”œâ”€â”€ config/
    â”‚   â”œâ”€â”€ DomainServiceConfig.java âœ…
    â”‚   â””â”€â”€ OpenApiConfig.java âœ…
    â””â”€â”€ infrastructure/config/
        â”œâ”€â”€ JpaConfig.java âœ…
        â”œâ”€â”€ QuartzConfig.java âœ…
        â””â”€â”€ SecurityConfig.java âœ…
```

---

## ğŸ¯ ê° ì„œë²„ì˜ ì—­í•  ë° ì˜ì¡´ì„±

### 1. chat-message-server
**ì—­í• :** ë©”ì‹œì§€ ë°œì†¡
**ì˜ì¡´ì„±:**
- âœ… chat-domain (Domain ëª¨ë¸)
- âœ… chat-storage (ë©”ì‹œì§€ ì €ì¥)
- âœ… Redis (ì´ë²¤íŠ¸ ë°œí–‰)

### 2. chat-system-server
**ì—­í• :** ì±„ë„ ê´€ë¦¬, ë©”ì‹œì§€ ì¡°íšŒ, ì˜ˆì•½ ë©”ì‹œì§€
**ì˜ì¡´ì„±:**
- âœ… chat-domain (Domain ëª¨ë¸)
- âœ… chat-storage (ì±„ë„/ë©”ì‹œì§€ ì¡°íšŒ)
- âœ… PostgreSQL (ë°ì´í„° ì €ì¥)
- âœ… Quartz (ìŠ¤ì¼€ì¤„ëŸ¬)

### 3. chat-websocket-server
**ì—­í• :** ì‹¤ì‹œê°„ WebSocket í†µì‹ 
**ì˜ì¡´ì„±:**
- âœ… chat-domain (Domain ëª¨ë¸ë§Œ ì‚¬ìš©)
- âŒ chat-storage (ë¶ˆí•„ìš” - ì €ì¥/ì¡°íšŒ ì•ˆí•¨)
- âœ… Redis (Session ê´€ë¦¬, Pub/Sub)
- âŒ PostgreSQL (ë¶ˆí•„ìš”)

---

## ğŸš€ ì„œë²„ ì‹¤í–‰ ë°©ë²•

### 1. ì¸í”„ë¼ ì‹¤í–‰ (Docker)
```bash
cd docker
docker-compose up -d
```

**ì‹¤í–‰ë˜ëŠ” ì„œë¹„ìŠ¤:**
- PostgreSQL (Primary) - 5432
- PostgreSQL (Replica) - 5433
- Redis - 16379

### 2. ê° ì„œë²„ ì‹¤í–‰

#### chat-message-server (í¬íŠ¸: 8081)
```bash
cd chat-message-server
../gradlew bootRun
```

#### chat-system-server (í¬íŠ¸: 8082)
```bash
cd chat-system-server
../gradlew bootRun
```

#### chat-websocket-server (í¬íŠ¸: 20002)
```bash
cd chat-websocket-server
../gradlew bootRun
```

---

## âœ… ë¹Œë“œ ê²€ì¦

### ì „ì²´ ë¹Œë“œ
```bash
./gradlew clean build -x test
```

**ê²°ê³¼:**
```
BUILD SUCCESSFUL in 4s
37 actionable tasks: 29 executed, 8 from cache
```

### ê°œë³„ ëª¨ë“ˆ ë¹Œë“œ
```bash
# chat-system-server
./gradlew :chat-system-server:clean :chat-system-server:build -x test

# ê²°ê³¼
BUILD SUCCESSFUL in 4s
17 actionable tasks: 6 executed, 4 from cache, 7 up-to-date
```

---

## ğŸ“‹ ì²´í¬ë¦¬ìŠ¤íŠ¸

### chat-websocket-server
- [x] JPA Auto Configuration ë¹„í™œì„±í™”
- [x] chat-storage ì˜ì¡´ì„± ì œê±°
- [x] Redis ì„¤ì • ì¶”ê°€
- [x] ë¹Œë“œ ì„±ê³µ

### chat-system-server
- [x] ì¤‘ë³µëœ QuartzConfig ì œê±°
- [x] config vs infrastructure íŒ¨í‚¤ì§€ ì •ë¦¬
- [x] ë¹Œë“œ ì„±ê³µ

### ì „ì²´ í”„ë¡œì íŠ¸
- [x] ë©€í‹°ëª¨ë“ˆ ë¹Œë“œ ì„±ê³µ
- [x] ì˜ì¡´ì„± ì •ë¦¬ ì™„ë£Œ
- [x] ì¤‘ë³µ íŒŒì¼ ì œê±° ì™„ë£Œ

---

## ğŸ“ í•™ìŠµ í¬ì¸íŠ¸

### 1. Spring Boot Auto Configuration
```java
// íŠ¹ì • Auto Configuration ë¹„í™œì„±í™”
@SpringBootApplication(exclude = {
    DataSourceAutoConfiguration.class,
    HibernateJpaAutoConfiguration.class
})
```

ë˜ëŠ” application.properties:
```properties
spring.autoconfigure.exclude=\
  org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration,\
  org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration
```

### 2. ëª¨ë“ˆ ì˜ì¡´ì„± ì„¤ê³„
- **Domain ëª¨ë“ˆ**: ëª¨ë“  ì„œë²„ê°€ ê³µìœ  (ìˆœìˆ˜ ë„ë©”ì¸)
- **Storage ëª¨ë“ˆ**: ì˜ì†ì„±ì´ í•„ìš”í•œ ì„œë²„ë§Œ ì‚¬ìš©
- **ê° ì„œë²„**: ìì‹ ì˜ ì—­í• ì— ë§ëŠ” ì˜ì¡´ì„±ë§Œ í¬í•¨

### 3. íŒ¨í‚¤ì§€ êµ¬ì¡°
```
src/main/java/com/example/chat/system/
â”œâ”€â”€ config/              # ì¼ë°˜ ì„¤ì • (ë„ë©”ì¸ ê´€ë ¨)
â””â”€â”€ infrastructure/      # ì¸í”„ë¼ ì„¤ì • (JPA, Quartz, Security ë“±)
    â””â”€â”€ config/
```

---

## ğŸ” ë¬¸ì œ í•´ê²° ê°€ì´ë“œ

### ë¬¸ì œ: DataSource ì„¤ì • ì˜¤ë¥˜
**ì¦ìƒ:**
```
Failed to configure a DataSource
```

**í•´ê²°:**
1. JPAê°€ í•„ìš”í•œê°€? â†’ NO â†’ Auto Configuration ë¹„í™œì„±í™”
2. JPAê°€ í•„ìš”í•œê°€? â†’ YES â†’ application.propertiesì— DataSource ì„¤ì •

### ë¬¸ì œ: Bean ì¶©ëŒ
**ì¦ìƒ:**
```
ConflictingBeanDefinitionException
```

**í•´ê²°:**
1. ì¤‘ë³µ íŒŒì¼ ê²€ìƒ‰: `find . -name "ClassName.java"`
2. ì ì ˆí•œ íŒŒì¼ ì„ íƒ (íŒ¨í‚¤ì§€ êµ¬ì¡° ê³ ë ¤)
3. ì¤‘ë³µ íŒŒì¼ ì‚­ì œ

---

## ğŸ“Š ìµœì¢… ìƒíƒœ

| ì„œë²„ | ë¹Œë“œ | ì‹¤í–‰ ì¤€ë¹„ | ì˜ì¡´ì„± |
|------|------|-----------|--------|
| chat-message-server | âœ… | âœ… | Domain, Storage, Redis |
| chat-system-server | âœ… | âœ… | Domain, Storage, PostgreSQL, Quartz |
| chat-websocket-server | âœ… | âœ… | Domain, Redis |

---

## ğŸ‰ ê²°ë¡ 

### í•´ê²°ëœ ë¬¸ì œ
1. âœ… chat-websocket-server DataSource ì˜¤ë¥˜ í•´ê²°
2. âœ… chat-system-server Bean ì¶©ëŒ í•´ê²°
3. âœ… ì¤‘ë³µ íŒŒì¼ ì œê±°
4. âœ… ì „ì²´ ë¹Œë“œ ì„±ê³µ

### ê°œì„  ì‚¬í•­
1. âœ… ê° ì„œë²„ì˜ ì—­í• ì— ë§ëŠ” ì˜ì¡´ì„± ì •ë¦¬
2. âœ… ë¶ˆí•„ìš”í•œ Auto Configuration ë¹„í™œì„±í™”
3. âœ… íŒ¨í‚¤ì§€ êµ¬ì¡° ì •ë¦¬ (config vs infrastructure)

### ë‹¤ìŒ ë‹¨ê³„
- ê° ì„œë²„ ì‹¤í–‰ í…ŒìŠ¤íŠ¸
- API ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸
- WebSocket ì—°ê²° í…ŒìŠ¤íŠ¸

---

**ì‘ì„±ì:** GitHub Copilot  
**ì‘ì„±ì¼:** 2025-12-13  
**ìƒíƒœ:** âœ… í•´ê²° ì™„ë£Œ  
**ë¹Œë“œ:** âœ… BUILD SUCCESSFUL
